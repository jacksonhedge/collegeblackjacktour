var oe=Object.defineProperty;var le=(r,t,s)=>t in r?oe(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s;var b=(r,t,s)=>le(r,typeof t!="symbol"?t+"":t,s);import{y as te,d as ae,r as u,j as e,ad as X,D as se,v as G,S as ne,A as de,X as Z,I as ue,C as re}from"./main-Bt21LLck.js";import{L as S}from"./loader-circle-BfyHU3N4.js";import{I as me}from"./info-2jzgaFUs.js";import{C as ie}from"./circle-check-big-PbtGHC_l.js";class he{constructor(){this.backendUrl="https://api.bankroll.live",this.isEnabled=!1}async makeBackendRequest(t,s="GET",c=null){if(!this.isEnabled)throw new Error("Bank connections are temporarily unavailable. Please try again later.");const a=`${this.backendUrl}/api/meld${t}`,i={"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")||""}`},o={method:s,headers:i,credentials:"include"};c&&s!=="GET"&&(o.body=JSON.stringify(c));try{const l=await fetch(a,o);if(!l.ok){const f=await l.json().catch(()=>({message:"Unknown error"}));throw new Error(f.message||`HTTP error! status: ${l.status}`)}return await l.json()}catch(l){throw console.error("Backend API Error:",l),l}}async createOrGetMeldUser(t){return this.makeBackendRequest("/users/create-or-get","POST",t)}async initiateBankConnection(t={}){if(!this.isEnabled)throw new Error("Bank connections are temporarily unavailable. Please try again later.");return this.makeBackendRequest("/connections","POST",t)}async getConnectedAccounts(){return this.makeBackendRequest("/accounts","GET")}async getAccountDetails(t){return this.makeBackendRequest(`/accounts/${t}`,"GET")}async getAccountTransactions(t,s={}){const c=new URLSearchParams(s).toString(),a=c?`/accounts/${t}/transactions?${c}`:`/accounts/${t}/transactions`;return this.makeBackendRequest(a,"GET")}async deleteBankConnection(t){return this.makeBackendRequest(`/connections/${t}`,"DELETE")}async getAvailableInstitutions(t=""){const s=t?`/institutions?search=${encodeURIComponent(t)}`:"/institutions";return this.makeBackendRequest(s,"GET")}async handleConnectCallback(t,s){return this.makeBackendRequest("/connections/callback","POST",{code:t,state:s})}async verifyMicroDeposits(t,s){return this.makeBackendRequest(`/accounts/${t}/verify`,"POST",{amounts:s})}async checkConnectionStatus(t){return this.makeBackendRequest(`/connections/${t}/status`,"GET")}}const ee=new he;var U=(r=>(r.ACTIVE="active",r.SUSPENDED="suspended",r.DEACTIVATED="deactivated",r))(U||{}),ce=(r=>(r.UNVERIFIED="unverified",r.PENDING="pending",r.VERIFIED="verified",r.RETRY="retry",r.DOCUMENT="document",r.SUSPENDED="suspended",r))(ce||{}),$=(r=>(r.CHECKING="checking",r.SAVINGS="savings",r.BALANCE="balance",r.CARD="card",r))($||{}),C=(r=>(r.UNVERIFIED="unverified",r.PENDING="pending",r.VERIFIED="verified",r.SUSPENDED="suspended",r.CLOSED="closed",r))(C||{}),A=(r=>(r.PENDING="pending",r.PROCESSING="processing",r.COMPLETED="completed",r.FAILED="failed",r.CANCELLED="cancelled",r))(A||{}),E=(r=>(r.CUSTOMER_CREATED="customer.created",r.CUSTOMER_UPDATED="customer.updated",r.CUSTOMER_VERIFIED="customer.verified",r.CUSTOMER_SUSPENDED="customer.suspended",r.ACCOUNT_ADDED="account.added",r.ACCOUNT_REMOVED="account.removed",r.ACCOUNT_VERIFIED="account.verified",r.TRANSFER_CREATED="transfer.created",r.TRANSFER_COMPLETED="transfer.completed",r.TRANSFER_FAILED="transfer.failed",r.TRANSFER_CANCELLED="transfer.cancelled",r))(E||{});class N extends Error{constructor(s,c,a,i){super(s);b(this,"code");b(this,"statusCode");b(this,"details");this.name="PaymentProviderError",this.code=c,this.statusCode=a,this.details=i}}class xe{constructor(t){b(this,"baseURL");b(this,"apiKey");b(this,"apiSecret");b(this,"accessToken",null);b(this,"tokenExpirationDate",null);b(this,"environment");this.baseURL=t.baseURL,this.apiKey=t.apiKey,this.apiSecret=t.apiSecret,this.environment=t.environment}async makeRequest(t,s={}){const c=`${this.baseURL}${t}`;try{const a=await fetch(c,{...s,headers:{...s.headers,"Content-Type":"application/json"}}),i=await a.text();let o;try{o=i?JSON.parse(i):null}catch{if(!a.ok)throw new N(`Request failed: ${a.statusText}`,"REQUEST_FAILED",a.status,i);o=i}if(!a.ok)throw new N((o==null?void 0:o.message)||`Request failed: ${a.statusText}`,(o==null?void 0:o.code)||"REQUEST_FAILED",a.status,o);return o}catch(a){throw a instanceof N?a:new N(a instanceof Error?a.message:"Unknown error occurred","NETWORK_ERROR")}}getAuthHeaders(){if(!this.accessToken)throw new N("Not authenticated. Please authenticate first.","AUTHENTICATION_REQUIRED");return{Authorization:`Bearer ${this.accessToken}`,"Content-Type":"application/json"}}validateConfig(){if(!this.apiKey)throw new N("API key is required","INVALID_CONFIG");if(!this.apiSecret)throw new N("API secret is required","INVALID_CONFIG");if(!this.baseURL)throw new N("Base URL is required","INVALID_CONFIG")}formatAmount(t){return Math.round(t*100)}parseAmount(t){return t/100}async retryWithBackoff(t,s=3,c=1e3){let a=null;for(let i=0;i<s;i++)try{return await t()}catch(o){if(a=o,o instanceof N&&o.statusCode&&o.statusCode<500)throw o;if(i<s-1){const l=c*Math.pow(2,i);await new Promise(f=>setTimeout(f,l))}}throw a||new Error("Retry failed")}async*paginate(t,s=50){let c=0,a=!0;for(;a;){const{items:i,total:o}=await t(c,s);i.length>0&&(yield i),c+=i.length,a=c<o}}}const ge={meld:{baseURL:"https://sandbox.meld.io/v1",apiKey:"",apiSecret:"",environment:"sandbox"}},q=ge,T=class T extends xe{constructor(){super({baseURL:q.meld.baseURL,apiKey:q.meld.apiKey,apiSecret:q.meld.apiSecret,environment:q.meld.environment})}static getInstance(){return T.instance||(T.instance=new T),T.instance}async authenticate(){if(this.validateConfig(),!(this.accessToken&&this.tokenExpirationDate&&this.tokenExpirationDate>new Date(Date.now()+3e5)))try{const t=await this.makeRequest("/auth/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:`Basic ${btoa(`${this.apiKey}:${this.apiSecret}`)}`},body:new URLSearchParams({grant_type:"client_credentials"}).toString()});this.accessToken=t.access_token,this.tokenExpirationDate=new Date(Date.now()+t.expires_in*1e3)}catch(t){throw new N("Failed to authenticate with Meld","AUTHENTICATION_FAILED",void 0,t)}}isAuthenticated(){return!!(this.accessToken&&this.tokenExpirationDate&&this.tokenExpirationDate>new Date)}async createCustomer(t){await this.authenticate();const s=await this.makeRequest("/customers",{method:"POST",headers:this.getAuthHeaders(),body:JSON.stringify({externalId:t.externalId,firstName:t.firstName,lastName:t.lastName,email:t.email,phone:t.phone,dateOfBirth:t.dateOfBirth,address:t.address})});return this.mapMeldCustomerToCustomer(s)}async getCustomer(t){await this.authenticate();const s=await this.makeRequest(`/customers/${t}`,{method:"GET",headers:this.getAuthHeaders()});return this.mapMeldCustomerToCustomer(s)}async updateCustomer(t,s){await this.authenticate();const c=await this.makeRequest(`/customers/${t}`,{method:"PATCH",headers:this.getAuthHeaders(),body:JSON.stringify(s)});return this.mapMeldCustomerToCustomer(c)}async deleteCustomer(t){await this.authenticate(),await this.makeRequest(`/customers/${t}`,{method:"DELETE",headers:this.getAuthHeaders()})}async getMeldLinkToken(t,s=["TRANSACTIONS","BALANCES"]){return await this.authenticate(),await this.makeRequest("/link/token",{method:"POST",headers:this.getAuthHeaders(),body:JSON.stringify({customerId:t,products:s,optionalProducts:["IDENTIFIERS","OWNERS"],accountPreferenceOverride:{allowRedirect:!0},webhook:`${window.location.origin}/api/webhooks/meld`})})}async linkAccount(t,s){if(await this.authenticate(),!s.meldToken)throw new N("Meld token is required for linking accounts","INVALID_ACCOUNT_DATA");const c=await this.makeRequest("/accounts/link",{method:"POST",headers:this.getAuthHeaders(),body:JSON.stringify({customerId:t,publicToken:s.meldToken})});return this.mapMeldAccountToAccount(c)}async getAccounts(t){return await this.authenticate(),(await this.makeRequest(`/customers/${t}/accounts`,{method:"GET",headers:this.getAuthHeaders()})).map(c=>this.mapMeldAccountToAccount(c))}async getAccount(t){await this.authenticate();const s=await this.makeRequest(`/accounts/${t}`,{method:"GET",headers:this.getAuthHeaders()});return this.mapMeldAccountToAccount(s)}async unlinkAccount(t){await this.authenticate(),await this.makeRequest(`/accounts/${t}`,{method:"DELETE",headers:this.getAuthHeaders()})}async getBalance(t){await this.authenticate();const s=await this.makeRequest(`/accounts/${t}/balance`,{method:"GET",headers:this.getAuthHeaders()});return{accountId:s.accountId,available:s.available,current:s.current,currency:s.currency,lastUpdated:new Date(s.lastUpdated)}}async createTransfer(t){await this.authenticate();const s=await this.makeRequest("/transfers",{method:"POST",headers:this.getAuthHeaders(),body:JSON.stringify({sourceAccountId:t.sourceAccountId,destinationAccountId:t.destinationAccountId,amount:this.formatAmount(t.amount),currency:t.currency,description:t.description,metadata:t.metadata})});return this.mapMeldTransferToTransfer(s)}async getTransfer(t){await this.authenticate();const s=await this.makeRequest(`/transfers/${t}`,{method:"GET",headers:this.getAuthHeaders()});return this.mapMeldTransferToTransfer(s)}async cancelTransfer(t){await this.authenticate(),await this.makeRequest(`/transfers/${t}/cancel`,{method:"POST",headers:this.getAuthHeaders()})}async listTransfers(t){await this.authenticate();const s=new URLSearchParams;return t&&(t.customerId&&s.append("customerId",t.customerId),t.accountId&&s.append("accountId",t.accountId),t.status&&s.append("status",t.status),t.startDate&&s.append("startDate",t.startDate.toISOString()),t.endDate&&s.append("endDate",t.endDate.toISOString()),t.limit&&s.append("limit",t.limit.toString()),t.offset&&s.append("offset",t.offset.toString())),(await this.makeRequest(`/transfers?${s.toString()}`,{method:"GET",headers:this.getAuthHeaders()})).map(a=>this.mapMeldTransferToTransfer(a))}async handleWebhook(t,s){if(!this.verifyWebhookSignature(t,s))throw new N("Invalid webhook signature","INVALID_WEBHOOK_SIGNATURE");return{id:t.id,type:this.mapMeldWebhookType(t.type),data:t.data,createdAt:new Date(t.created_at)}}mapMeldCustomerToCustomer(t){return{id:t.id,firstName:t.firstName,lastName:t.lastName,email:t.email,phone:t.phone,status:this.mapMeldCustomerStatus(t.status),verificationStatus:ce.VERIFIED,createdAt:new Date(t.createdAt),updatedAt:new Date(t.updatedAt),metadata:{externalId:t.externalId}}}mapMeldAccountToAccount(t){return{id:t.id,customerId:t.customerId,name:t.accountName,type:this.mapMeldAccountType(t.accountType),subtype:t.accountSubtype,status:this.mapMeldAccountStatus(t.status),bankName:t.institutionName,last4:t.mask,createdAt:new Date(t.createdAt),updatedAt:new Date(t.updatedAt)}}mapMeldTransferToTransfer(t){return{id:t.id,sourceAccountId:t.sourceAccountId,destinationAccountId:t.destinationAccountId,amount:this.parseAmount(t.amount),currency:t.currency,status:this.mapMeldTransferStatus(t.status),description:t.description,createdAt:new Date(t.createdAt),updatedAt:new Date(t.updatedAt)}}mapMeldCustomerStatus(t){return{active:U.ACTIVE,suspended:U.SUSPENDED,deactivated:U.DEACTIVATED}[t]||U.ACTIVE}mapMeldAccountType(t){return{checking:$.CHECKING,savings:$.SAVINGS,balance:$.BALANCE,card:$.CARD}[t]||$.CHECKING}mapMeldAccountStatus(t){return{unverified:C.UNVERIFIED,pending:C.PENDING,verified:C.VERIFIED,suspended:C.SUSPENDED,closed:C.CLOSED}[t]||C.PENDING}mapMeldTransferStatus(t){return{pending:A.PENDING,processing:A.PROCESSING,completed:A.COMPLETED,failed:A.FAILED,cancelled:A.CANCELLED}[t]||A.PENDING}mapMeldWebhookType(t){return{"customer.created":E.CUSTOMER_CREATED,"customer.updated":E.CUSTOMER_UPDATED,"account.added":E.ACCOUNT_ADDED,"account.removed":E.ACCOUNT_REMOVED,"transfer.created":E.TRANSFER_CREATED,"transfer.completed":E.TRANSFER_COMPLETED,"transfer.failed":E.TRANSFER_FAILED}[t]||E.CUSTOMER_UPDATED}verifyWebhookSignature(t,s){return!0}};b(T,"instance",null);let M=T;const ye=({onSuccess:r,onClose:t,connectedAccount:s})=>{const{currentUser:c}=te(),{isDark:a}=ae(),[i,o]=u.useState("amount"),[l,f]=u.useState(""),[v,p]=u.useState(!1),[k,h]=u.useState(null),[w,x]=u.useState([]),[m,j]=u.useState(null),[g,O]=u.useState(null),[B,H]=u.useState(null);u.useEffect(()=>{s&&j(s),I()},[s]);const I=async()=>{var n;try{p(!0);const d=M.getInstance(),y=(n=c.user_metadata)==null?void 0:n.meld_customer_id;if(!y){h("Please connect a bank account first");return}const P=await d.getAccounts(y);if(x(P),P.length>0&&!m){j(P[0]);const F=await d.getBalance(P[0].id);O(F)}}catch(d){console.error("Error loading accounts:",d),h("Failed to load bank accounts")}finally{p(!1)}},V=n=>{const d=n.target.value;(/^\d*\.?\d{0,2}$/.test(d)||d==="")&&f(d)},D=n=>{const d=parseFloat(n)||0;return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(d)},z=()=>{const n=parseFloat(l);if(!n||n<=0){h("Please enter a valid amount");return}if(n<1){h("Minimum deposit amount is $1.00");return}if(n>1e4){h("Maximum deposit amount is $10,000.00");return}if(g&&n>g.available){h("Insufficient funds in your bank account");return}h(null),o("confirm")},K=async()=>{try{p(!0),h(null),o("processing");const n=M.getInstance(),d=void 0;if(!d)throw new Error("Bankroll account configuration missing");const y=await n.createTransfer({sourceAccountId:m.id,destinationAccountId:d,amount:parseFloat(l),currency:"USD",description:`Bankroll wallet deposit - ${c.email}`,metadata:{userId:c.id,userEmail:c.email,depositType:"wallet_funding"}});H(y.id),await R(y.id)}catch(n){console.error("Error creating transfer:",n),h(n.message||"Failed to initiate transfer"),o("error")}finally{p(!1)}},R=async(n,d=0)=>{if(d>=30){h("Transfer is taking longer than expected. Please check your transaction history."),o("error");return}try{const _=await M.getInstance().getTransfer(n);_.status==="completed"?(o("success"),r&&r({amount:_.amount,transferId:_.id,accountName:m.name,bankName:m.bankName})):_.status==="failed"?(h("Transfer failed. Please try again or contact support."),o("error")):setTimeout(()=>R(n,d+1),3e3)}catch(F){console.error("Error polling transfer status:",F),h("Unable to check transfer status"),o("error")}},L=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("img",{src:"/images/hedge-pay-logo.png",alt:"Hedge Pay",className:"h-10 w-auto"})}),e.jsx("h2",{className:`text-2xl font-bold mb-2 ${a?"text-white":"text-gray-900"}`,children:"ACH by Hedge Pay"}),e.jsx("p",{className:`text-sm ${a?"text-gray-400":"text-gray-600"}`,children:"Transfer money from your bank account"})]}),w.length>1&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:`text-sm font-medium ${a?"text-gray-300":"text-gray-700"}`,children:"Select Bank Account"}),e.jsx("select",{value:(m==null?void 0:m.id)||"",onChange:n=>{const d=w.find(y=>y.id===n.target.value);j(d)},className:`w-full px-4 py-3 rounded-lg border ${a?"bg-gray-800 border-gray-700 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:ring-2 focus:ring-purple-500`,children:w.map(n=>e.jsxs("option",{value:n.id,children:[n.bankName," - ",n.name," (...",n.last4,")"]},n.id))})]}),m&&e.jsx("div",{className:`p-4 rounded-lg border ${a?"bg-gray-800 border-gray-700":"bg-gray-50 border-gray-200"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(X,{className:`w-5 h-5 ${a?"text-gray-400":"text-gray-500"}`}),e.jsxs("div",{children:[e.jsx("p",{className:`font-medium ${a?"text-white":"text-gray-900"}`,children:m.bankName}),e.jsxs("p",{className:`text-sm ${a?"text-gray-400":"text-gray-600"}`,children:[m.name," (...",m.last4,")"]})]})]}),g&&e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Available"}),e.jsx("p",{className:`font-medium ${a?"text-green-400":"text-green-600"}`,children:D(g.available)})]})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:`text-sm font-medium ${a?"text-gray-300":"text-gray-700"}`,children:"Amount to Deposit"}),e.jsxs("div",{className:"relative",children:[e.jsx(se,{className:`absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 ${a?"text-gray-400":"text-gray-500"}`}),e.jsx("input",{type:"text",value:l,onChange:V,placeholder:"0.00",className:`w-full pl-10 pr-4 py-3 text-2xl font-medium rounded-lg border ${a?"bg-gray-800 border-gray-700 text-white placeholder-gray-500":"bg-white border-gray-300 text-gray-900 placeholder-gray-400"} focus:outline-none focus:ring-2 focus:ring-purple-500`})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Minimum: $1.00 â€¢ Maximum: $10,000.00"})]}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:["25","50","100","250"].map(n=>e.jsxs("button",{onClick:()=>f(n),className:`py-2 rounded-lg border transition-colors ${a?"border-gray-700 hover:bg-gray-800 text-gray-300":"border-gray-300 hover:bg-gray-50 text-gray-700"}`,children:["$",n]},n))}),k&&e.jsxs("div",{className:"flex items-center gap-2 p-3 rounded-lg bg-red-500/10 border border-red-500/20",children:[e.jsx(G,{className:"w-4 h-4 text-red-500"}),e.jsx("p",{className:"text-sm text-red-500",children:k})]}),e.jsx("button",{onClick:z,disabled:!l||parseFloat(l)<=0,className:`w-full py-3 rounded-lg font-medium transition-all ${!l||parseFloat(l)<=0?a?"bg-gray-700 text-gray-500 cursor-not-allowed":"bg-gray-200 text-gray-400 cursor-not-allowed":"bg-purple-600 text-white hover:bg-purple-700"}`,children:"Continue"}),e.jsxs("div",{className:`flex items-start gap-2 p-3 rounded-lg ${a?"bg-gray-800":"bg-gray-50"}`,children:[e.jsx(me,{className:`w-4 h-4 mt-0.5 ${a?"text-gray-400":"text-gray-500"}`}),e.jsxs("div",{className:`text-xs ${a?"text-gray-400":"text-gray-600"}`,children:[e.jsx("p",{children:"ACH transfers typically take 1-3 business days to complete."}),e.jsx("p",{className:"mt-1",children:"Funds will be available in your Bankroll wallet once the transfer is confirmed."})]})]})]}),J=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("img",{src:"/images/hedge-pay-logo.png",alt:"Hedge Pay",className:"h-10 w-auto"})}),e.jsx("h2",{className:`text-2xl font-bold mb-2 ${a?"text-white":"text-gray-900"}`,children:"Confirm Transfer"}),e.jsx("p",{className:`text-sm ${a?"text-gray-400":"text-gray-600"}`,children:"Review your transfer details"})]}),e.jsxs("div",{className:`space-y-4 p-4 rounded-lg border ${a?"bg-gray-800 border-gray-700":"bg-gray-50 border-gray-200"}`,children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:`text-sm ${a?"text-gray-400":"text-gray-600"}`,children:"From"}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:`font-medium ${a?"text-white":"text-gray-900"}`,children:m.bankName}),e.jsxs("p",{className:`text-sm ${a?"text-gray-400":"text-gray-600"}`,children:[m.name," (...",m.last4,")"]})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:`text-sm ${a?"text-gray-400":"text-gray-600"}`,children:"To"}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:`font-medium ${a?"text-white":"text-gray-900"}`,children:"Bankroll Wallet"}),e.jsx("p",{className:`text-sm ${a?"text-gray-400":"text-gray-600"}`,children:c.email})]})]}),e.jsx("div",{className:"border-t pt-4 ${isDark ? 'border-gray-700' : 'border-gray-200'}",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:`text-sm ${a?"text-gray-400":"text-gray-600"}`,children:"Amount"}),e.jsx("span",{className:`text-2xl font-bold ${a?"text-white":"text-gray-900"}`,children:D(l)})]})}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:`text-sm ${a?"text-gray-400":"text-gray-600"}`,children:"Fee"}),e.jsx("span",{className:"font-medium text-green-500",children:"FREE"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:`text-sm ${a?"text-gray-400":"text-gray-600"}`,children:"Processing Time"}),e.jsx("span",{className:`text-sm ${a?"text-gray-300":"text-gray-700"}`,children:"1-3 business days"})]})]}),e.jsxs("div",{className:`flex items-center justify-center gap-2 p-3 rounded-lg ${a?"bg-gray-800":"bg-gray-50"}`,children:[e.jsx(ne,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:`text-xs ${a?"text-gray-400":"text-gray-600"}`,children:"Your transfer is protected by bank-level security"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>o("amount"),className:`flex-1 py-3 rounded-lg border transition-colors ${a?"border-gray-700 hover:bg-gray-800 text-gray-300":"border-gray-300 hover:bg-gray-50 text-gray-700"}`,children:[e.jsx(de,{className:"w-4 h-4 inline mr-2"}),"Back"]}),e.jsx("button",{onClick:K,disabled:v,className:"flex-1 py-3 rounded-lg bg-purple-600 text-white font-medium hover:bg-purple-700 transition-colors disabled:opacity-50",children:v?e.jsx(S,{className:"w-4 h-4 animate-spin mx-auto"}):"Confirm Transfer"})]})]}),Y=()=>e.jsxs("div",{className:"text-center py-12 space-y-6",children:[e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{className:"relative",children:[e.jsx(S,{className:"w-16 h-16 animate-spin text-purple-600"}),e.jsx(se,{className:"w-8 h-8 absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-purple-600"})]})}),e.jsxs("div",{children:[e.jsx("h3",{className:`text-xl font-semibold mb-2 ${a?"text-white":"text-gray-900"}`,children:"Processing Transfer"}),e.jsx("p",{className:`text-sm ${a?"text-gray-400":"text-gray-600"}`,children:"Initiating your ACH transfer..."})]}),e.jsx("div",{className:"text-xs text-gray-500",children:"This may take a few moments"})]}),Q=()=>e.jsxs("div",{className:"text-center py-12 space-y-6",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(ie,{className:"w-10 h-10 text-green-600"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:`text-xl font-semibold mb-2 ${a?"text-white":"text-gray-900"}`,children:"Transfer Initiated!"}),e.jsx("p",{className:`text-2xl font-bold ${a?"text-green-400":"text-green-600"}`,children:D(l)}),e.jsx("p",{className:`text-sm mt-2 ${a?"text-gray-400":"text-gray-600"}`,children:"Your funds will be available in 1-3 business days"})]}),B&&e.jsxs("div",{className:"text-xs text-gray-500",children:["Transfer ID: ",B]}),e.jsx("button",{onClick:t,className:"px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:"Done"})]}),W=()=>e.jsxs("div",{className:"text-center py-12 space-y-6",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx(G,{className:"w-10 h-10 text-red-600"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:`text-xl font-semibold mb-2 ${a?"text-white":"text-gray-900"}`,children:"Transfer Failed"}),e.jsx("p",{className:`text-sm ${a?"text-gray-400":"text-gray-600"}`,children:k||"Unable to process your transfer"})]}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx("button",{onClick:()=>{o("amount"),h(null)},className:"px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:"Try Again"}),e.jsx("button",{onClick:t,className:`px-6 py-2 rounded-lg transition-colors ${a?"bg-gray-700 text-gray-300 hover:bg-gray-600":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:"Cancel"})]})]});return v&&i==="amount"?e.jsx("div",{className:`relative max-w-md w-full mx-auto p-6 rounded-2xl ${a?"bg-gray-900":"bg-white"} shadow-xl`,children:e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(S,{className:"w-8 h-8 animate-spin text-purple-600"})})}):e.jsxs("div",{className:`relative max-w-md w-full mx-auto p-6 rounded-2xl ${a?"bg-gray-900":"bg-white"} shadow-xl`,children:[i==="amount"&&L(),i==="confirm"&&J(),i==="processing"&&Y(),i==="success"&&Q(),i==="error"&&W()]})},pe=({onSuccess:r,onClose:t})=>{const{currentUser:s}=te(),{isDark:c}=ae(),[a,i]=u.useState(!0),[o,l]=u.useState(null),[f,v]=u.useState(null),[p,k]=u.useState(null);u.useEffect(()=>{h()},[]),u.useEffect(()=>{const x=m=>{if(!m.origin.includes("meld.io"))return;const{type:j,data:g}=m.data;switch(j){case"CONNECT_COMPLETE":w(g);break;case"CONNECT_EXIT":g.error?l("Connection failed. Please try again."):t();break;case"CONNECT_ERROR":l(g.message||"An error occurred during connection.");break}};return window.addEventListener("message",x),()=>window.removeEventListener("message",x)},[t]);const h=async()=>{try{i(!0);const x=await ee.initiateBankConnection({user_id:s.id,products:["BALANCES","TRANSACTIONS"],optionalProducts:["IDENTIFIERS"],regions:["US"]});x.widgetUrl&&(v(x.widgetUrl),k(x.connectionId))}catch(x){console.error("Error initializing Meld Connect:",x),l("Failed to initialize bank connection. Please try again.")}finally{i(!1)}},w=async x=>{try{i(!0);const m=await fetch(`undefined/api/meld/connections/${p}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")||""}`}});if(!m.ok)throw new Error("Failed to get connection details");const j=await m.json(),g=await fetch(`undefined/api/meld/connections/${p}/accounts`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")||""}`}});if(!g.ok)throw new Error("Failed to get accounts");const O=await g.json();r&&r({connectionId:p,accounts:O.data||[],institution:x.institution,...j})}catch(m){console.error("Error completing connection:",m),l("Failed to complete bank connection. Please try again.")}finally{i(!1)}};return o?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:t}),e.jsxs("div",{className:`relative p-8 rounded-2xl ${c?"bg-gray-900":"bg-white"} shadow-xl max-w-md w-full`,children:[e.jsx("button",{onClick:t,className:`absolute top-4 right-4 p-2 rounded-lg transition-colors ${c?"hover:bg-gray-800 text-gray-400":"hover:bg-gray-100 text-gray-600"}`,children:e.jsx(Z,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsx(G,{className:"w-12 h-12 text-red-500"}),e.jsx("h3",{className:`text-lg font-semibold ${c?"text-white":"text-gray-900"}`,children:"Connection Error"}),e.jsx("p",{className:`text-center ${c?"text-gray-400":"text-gray-600"}`,children:o}),e.jsxs("div",{className:"flex gap-3 mt-4",children:[e.jsx("button",{onClick:()=>{l(null),h()},className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:"Try Again"}),e.jsx("button",{onClick:t,className:`px-4 py-2 rounded-lg transition-colors ${c?"bg-gray-800 text-gray-300 hover:bg-gray-700":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:"Cancel"})]})]})]})]}):a&&!f?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm",children:e.jsx("div",{className:`p-8 rounded-2xl ${c?"bg-gray-900":"bg-white"} shadow-xl`,children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsx(S,{className:"w-8 h-8 animate-spin text-purple-600"}),e.jsx("p",{className:`text-sm ${c?"text-gray-400":"text-gray-600"}`,children:"Initializing secure bank connection..."})]})})}):f?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm"}),e.jsxs("div",{className:"relative w-full max-w-md h-[640px] bg-white rounded-xl shadow-2xl overflow-hidden",children:[e.jsxs("div",{className:`flex items-center justify-between p-4 border-b ${c?"bg-gray-900 border-gray-800":"bg-white border-gray-200"}`,children:[e.jsx("h3",{className:`text-lg font-semibold ${c?"text-white":"text-gray-900"}`,children:"Connect Your Bank"}),e.jsx("button",{onClick:t,className:`p-2 rounded-lg transition-colors ${c?"hover:bg-gray-800 text-gray-400":"hover:bg-gray-100 text-gray-600"}`,children:e.jsx(Z,{className:"w-5 h-5"})})]}),e.jsx("iframe",{src:f,className:"w-full h-full",style:{border:"none"},title:"Meld Bank Connection"})]})]}):null},Ee=({onSuccess:r,onClose:t,proceedToPayment:s=!1,useDropIn:c=!0})=>{const{currentUser:a}=te(),{isDark:i}=ae(),[o,l]=u.useState("search"),[f,v]=u.useState([]),[p,k]=u.useState(""),[h,w]=u.useState(!1),[x,m]=u.useState(null),[j,g]=u.useState(null),[O,B]=u.useState(null),[H,I]=u.useState(null),V=c&&!1,D=[{id:"chase",name:"Chase",logo:"ðŸ¦"},{id:"bofa",name:"Bank of America",logo:"ðŸ›ï¸"},{id:"wells_fargo",name:"Wells Fargo",logo:"ðŸª"},{id:"capital_one",name:"Capital One",logo:"ðŸ’³"},{id:"pnc",name:"PNC Bank",logo:"ðŸ¦"},{id:"us_bank",name:"US Bank",logo:"ðŸ›ï¸"}];u.useEffect(()=>{z()},[]),u.useEffect(()=>{if(p){const n=setTimeout(()=>{K()},300);return()=>clearTimeout(n)}else v([])},[p]);const z=async()=>{var n,d;try{w(!0);const y={email:a.email,firstName:((n=a.user_metadata)==null?void 0:n.first_name)||"",lastName:((d=a.user_metadata)==null?void 0:d.last_name)||"",userId:a.id};B(y)}catch(y){console.error("Error initializing Meld user:",y),g("Failed to initialize bank connection")}finally{w(!1)}},K=async()=>{try{w(!0);const n=await ee.makeBackendRequest(`/institutions?q=${encodeURIComponent(p)}`,"GET");v(n.data||[])}catch(n){console.error("Error searching institutions:",n),n.message&&n.message.includes("temporarily unavailable")&&(g("Bank connections are temporarily unavailable. Please try again later."),l("error"))}finally{w(!1)}},R=async n=>{try{m(n),l("connecting"),g(null);const d=await ee.makeBackendRequest("/connections","POST",{user_id:a.id,institution_id:n.id,products:["accounts","transactions"],webhook_url:`${window.location.origin}/api/webhooks/meld`,redirect_url:`${window.location.origin}/banking`});d.connectUrl?(window.open(d.connectUrl,"meld-connect","width=500,height=700"),window.addEventListener("message",L)):setTimeout(()=>{const y={id:`mock_${Date.now()}`,name:"Checking Account",bankName:n.name,last4:"1234",type:"checking"};I(y),s?l("payment"):(l("success"),r&&r({institution:n.name,accountsConnected:1,account:y}))},2e3)}catch(d){console.error("Error connecting to bank:",d),d.message&&d.message.includes("temporarily unavailable")?g("Bank connections are temporarily unavailable. Please try again later."):g(d.message||"Failed to connect to bank"),l("error")}},L=n=>{if(n.origin!=="https://connect.meld.io"&&n.origin!=="https://connect-sb.meld.io")return;const{type:d,data:y}=n.data;d==="meld-connect-success"?(I(y.account),s?l("payment"):(l("success"),r&&r(y))):d==="meld-connect-error"&&(g(y.message||"Connection failed"),l("error")),window.removeEventListener("message",L)},J=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("img",{src:"/images/hedge-pay-logo.png",alt:"Hedge Pay",className:"h-12 w-auto"})}),e.jsx("h2",{className:`text-2xl font-bold mb-2 ${i?"text-white":"text-gray-900"}`,children:"ACH by Hedge Pay"}),e.jsx("p",{className:`text-sm ${i?"text-gray-400":"text-gray-600"}`,children:"Securely connect your bank account for instant transfers"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ue,{className:`absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 ${i?"text-gray-400":"text-gray-500"}`}),e.jsx("input",{type:"text",value:p,onChange:n=>k(n.target.value),placeholder:"Search for your bank...",className:`w-full pl-10 pr-4 py-3 rounded-lg border ${i?"bg-gray-800 border-gray-700 text-white placeholder-gray-500":"bg-white border-gray-300 text-gray-900 placeholder-gray-400"} focus:outline-none focus:ring-2 focus:ring-purple-500`})]}),!p&&e.jsxs("div",{children:[e.jsx("h3",{className:`text-sm font-medium mb-3 ${i?"text-gray-400":"text-gray-600"}`,children:"Popular Banks"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:D.map(n=>e.jsxs("button",{onClick:()=>R(n),className:`flex items-center gap-3 p-3 rounded-lg border transition-all ${i?"bg-gray-800 border-gray-700 hover:bg-gray-700":"bg-white border-gray-200 hover:bg-gray-50"}`,children:[e.jsx("span",{className:"text-2xl",children:n.logo}),e.jsx("span",{className:`text-sm font-medium ${i?"text-white":"text-gray-900"}`,children:n.name}),e.jsx(re,{className:`w-4 h-4 ml-auto ${i?"text-gray-400":"text-gray-500"}`})]},n.id))})]}),p&&f.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:`text-sm font-medium mb-3 ${i?"text-gray-400":"text-gray-600"}`,children:"Search Results"}),f.map(n=>e.jsxs("button",{onClick:()=>R(n),className:`w-full flex items-center gap-3 p-3 rounded-lg border transition-all ${i?"bg-gray-800 border-gray-700 hover:bg-gray-700":"bg-white border-gray-200 hover:bg-gray-50"}`,children:[e.jsx(X,{className:`w-5 h-5 ${i?"text-gray-400":"text-gray-500"}`}),e.jsx("span",{className:`font-medium ${i?"text-white":"text-gray-900"}`,children:n.name}),e.jsx(re,{className:`w-4 h-4 ml-auto ${i?"text-gray-400":"text-gray-500"}`})]},n.id))]}),h&&p&&e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(S,{className:"w-6 h-6 animate-spin text-purple-600"})}),p&&!h&&f.length===0&&e.jsxs("div",{className:`text-center py-8 ${i?"text-gray-400":"text-gray-600"}`,children:['No banks found matching "',p,'"']}),e.jsxs("div",{className:`flex items-center justify-center gap-2 pt-4 ${i?"text-gray-500":"text-gray-400"}`,children:[e.jsx(ne,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs",children:"Bank-level encryption powered by Hedge Pay"})]})]}),Y=()=>e.jsxs("div",{className:"text-center py-12 space-y-6",children:[e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{className:"relative",children:[e.jsx(S,{className:"w-16 h-16 animate-spin text-purple-600"}),e.jsx(X,{className:"w-8 h-8 absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-purple-600"})]})}),e.jsxs("div",{children:[e.jsxs("h3",{className:`text-xl font-semibold mb-2 ${i?"text-white":"text-gray-900"}`,children:["Connecting to ",x==null?void 0:x.name]}),e.jsx("p",{className:`text-sm ${i?"text-gray-400":"text-gray-600"}`,children:"This may take a few moments..."})]})]}),Q=()=>e.jsxs("div",{className:"text-center py-12 space-y-6",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(ie,{className:"w-10 h-10 text-green-600"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:`text-xl font-semibold mb-2 ${i?"text-white":"text-gray-900"}`,children:"Bank Connected Successfully!"}),e.jsxs("p",{className:`text-sm ${i?"text-gray-400":"text-gray-600"}`,children:["Your ",x==null?void 0:x.name," account has been linked"]})]}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx("button",{onClick:()=>l("payment"),className:"px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:"Add Funds Now"}),e.jsx("button",{onClick:t,className:`px-6 py-2 rounded-lg transition-colors ${i?"bg-gray-700 text-gray-300 hover:bg-gray-600":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:"Done"})]})]}),W=()=>e.jsxs("div",{className:"text-center py-12 space-y-6",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx(G,{className:"w-10 h-10 text-red-600"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:`text-xl font-semibold mb-2 ${i?"text-white":"text-gray-900"}`,children:"Connection Failed"}),e.jsx("p",{className:`text-sm ${i?"text-gray-400":"text-gray-600"}`,children:j||"Unable to connect to your bank"})]}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx("button",{onClick:()=>{l("search"),g(null)},className:"px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:"Try Again"}),e.jsx("button",{onClick:t,className:`px-6 py-2 rounded-lg transition-colors ${i?"bg-gray-700 text-gray-300 hover:bg-gray-600":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:"Cancel"})]})]});return V?e.jsx(pe,{onSuccess:n=>{I(n.account),s?l("payment"):r&&r(n)},onClose:t}):o==="payment"?e.jsx(ye,{connectedAccount:H,onSuccess:n=>{r&&r({...n,bankConnected:!0})},onClose:t}):e.jsxs("div",{className:`relative max-w-md w-full mx-auto p-6 rounded-2xl ${i?"bg-gray-900":"bg-white"} shadow-xl`,children:[e.jsx("button",{onClick:t,className:`absolute top-4 right-4 p-2 rounded-lg transition-colors ${i?"hover:bg-gray-800 text-gray-400":"hover:bg-gray-100 text-gray-600"}`,children:e.jsx(Z,{className:"w-5 h-5"})}),o==="search"&&J(),o==="connecting"&&Y(),o==="success"&&Q(),o==="error"&&W(),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-yellow-500/20 border-t border-yellow-500/40 px-4 py-2",children:e.jsx("p",{className:"text-xs text-yellow-600 text-center",children:"ðŸ§ª Test Mode - Use sandbox credentials for testing"})})]})};export{Ee as M};
