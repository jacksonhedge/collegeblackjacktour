const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ResendInviteService-BnnlyYs3.js","assets/main-Bt21LLck.js","assets/main-D0prcIsd.css"])))=>i.map(i=>d[i]);
import{a7 as xe,at as ie,e as F,f as $,g as A,i as ee,h as oe,Y as re,aT as ge,$ as _,aU as le,r as u,K as h,j as e,E as fe,b as ye,F as be,y as we,J as ve,aV as Se,Q as je,a1 as Ne,X as ce,a2 as ke,V as $e,I as Ce,aI as Ee,aW as Me,_ as Ie}from"./main-Bt21LLck.js";import"./alert-CI59Zt6X.js";import{B as j}from"./button-BARmkLdK.js";import{I as Ue}from"./input-mT1JNf1K.js";import ae from"./EmailService-J_ppV6FB.js";import{K as _e}from"./key-mOMej07n.js";import{C as Be}from"./copy-By8Hpzvk.js";import{M as W}from"./mail-Dke56W7c.js";import{M as te}from"./message-square-Wx_HBuIi.js";import{S as De}from"./share-2-B0yFjM8-.js";/**
 * @license lucide-react v0.363.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=xe("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);class Re{static async getAllUsers(){try{if(!ie.currentUser)throw new Error("User must be authenticated to access admin data");if(!(await ie.currentUser.getIdTokenResult()).claims.admin)throw new Error("User must be an admin to access this data");const t=F($,"users"),r=await A(t),a=[];for(const n of r.docs)try{const o=n.data();let c=0,l=0;const w=F($,"users",n.id,"subwallets");(await A(w)).forEach(b=>{const{balance:G=0,bonusBalance:d=0}=b.data();c+=Number(G)||0,l+=Number(d)||0});let y=[];const C=F($,"users",n.id,"sleeper_leagues"),E=await A(C);y=y.concat(E.docs.map(b=>b.data()));const p=F($,"users",n.id,"espn_leagues"),I=await A(p);y=y.concat(I.docs.map(b=>b.data()));const H=F($,"users",n.id,"yahoo_leagues"),L=await A(H);y=y.concat(L.docs.map(b=>b.data()));const Y=F($,"users",n.id,"friends"),k=(await A(Y)).docs.map(b=>b.data()),B=F($,"users",n.id,"referrals"),J=(await A(B)).docs.map(b=>b.data());a.push({id:n.id,...o,totalCashBalance:c,totalBonusBalance:l,leagues:y,friends:k,referrals:J})}catch(o){console.error(`Error processing user ${n.id}:`,o);continue}return a}catch(s){throw console.error("Error getting all users:",s),s}}static async updateMeldCustomerId(s,t){try{const r=ee($,"users",s);await oe(r,{meldCustomerId:t,lastUpdated:new Date})}catch(r){throw console.error("Error updating Meld customer ID:",r),r}}static async initializeUserIfNeeded(s){try{const t=ee($,"users",s);(await re(t)).exists()||await ge(t,{createdAt:new Date().toISOString(),lastSpinTime:null})}catch(t){throw console.error("Error initializing user:",t),t}}static async updateLastSpinTime(s){try{const t=ee($,"users",s);(await re(t)).exists()||await this.initializeUserIfNeeded(s),await oe(t,{lastSpinTime:new Date().toISOString()})}catch(t){throw console.error("Error updating last spin time:",t),t}}static async getLastSpinTime(s){try{await this.initializeUserIfNeeded(s);const t=ee($,"users",s),r=await re(t);return r.exists()?r.data().lastSpinTime:null}catch(t){throw console.error("Error getting last spin time:",t),t}}static canUserSpin(s){if(!s)return!0;const t=new Date(s);return(new Date-t)/(1e3*60*60)>=24}static async searchUsers(s){try{const t=s.toLowerCase(),r=F($,"users"),a=await A(r),n=[];return a.forEach(o=>{var C,E,p;const c=o.data(),l={uid:o.id,...c},w=(C=l.displayName)==null?void 0:C.toLowerCase().includes(t),v=(E=l.email)==null?void 0:E.toLowerCase().includes(t),y=(p=l.phoneNumber)==null?void 0:p.includes(s);(w||v||y)&&n.push(l)}),n}catch(t){throw console.error("Error searching users:",t),t}}}class Pe{async sendSMS(s,t){try{const{data:r,error:a}=await _.functions.invoke("send-sms",{body:{to:s,message:t}});if(a)throw a;return r}catch(r){throw console.error("Error sending SMS:",r),r}}async sendInviteDeclinedSMS({inviterPhone:s,inviteeName:t,groupName:r}){const a=`Bankroll: ${t} declined your invitation to join "${r}". You can invite other friends to grow your group!`;return this.sendSMS(s,a)}async sendInviteAcceptedSMS({inviterPhone:s,inviteeName:t,groupName:r}){const a=`Bankroll: Great news! ${t} just joined your group "${r}". Welcome them to the team! üéâ`;return this.sendSMS(s,a)}async sendMoneySentSMS({senderPhone:s,recipientName:t,amount:r,note:a}){let o=`Bankroll: You sent ${new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:r%1===0?0:2}).format(r)} to ${t}.`;return a&&(o+=` Note: "${a.substring(0,50)}${a.length>50?"...":""}"`),this.sendSMS(s,o)}async sendMoneyReceivedSMS({recipientPhone:s,senderName:t,amount:r,note:a}){const n=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:r%1===0?0:2}).format(r);let o=`Bankroll: ${t} sent you ${n}!`;return a&&(o+=` "${a.substring(0,50)}${a.length>50?"...":""}"`),this.sendSMS(s,o)}async sendMoneyRequestSMS({requestedPhone:s,requesterName:t,amount:r,note:a}){const n=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:r%1===0?0:2}).format(r);let o=`Bankroll: ${t} requested ${n} from you.`;return a&&(o+=` "${a.substring(0,40)}${a.length>40?"...":""}"`),o+=" Open app to respond.",this.sendSMS(s,o)}async sendGroupInviteSMS({inviteePhone:s,inviterName:t,groupName:r,inviteLink:a}){const n=`Bankroll: ${t} invited you to join "${r}". Join now: ${a}`;return this.sendSMS(s,n)}async sendBulkSMS(s,t){const r=s.map(n=>this.sendSMS(n,t).catch(o=>({phone:n,error:o.message,success:!1}))),a=await Promise.all(r);return{sent:a.filter(n=>!n.error).length,failed:a.filter(n=>n.error),total:s.length}}formatPhoneNumber(s){const t=s.replace(/\D/g,"");return t.length===10?`+1${t}`:t.length===11&&t.startsWith("1")?`+${t}`:s.startsWith("+")?s:`+${s}`}async isUserSMSEnabled(s){try{const{data:t}=await _.from("notification_preferences").select("sms_enabled, phone_number").eq("user_id",s).single();return(t==null?void 0:t.sms_enabled)&&(t==null?void 0:t.phone_number)}catch(t){return console.error("Error checking SMS preferences:",t),!1}}async getUserPhone(s){try{const{data:t}=await _.from("notification_preferences").select("phone_number").eq("user_id",s).single();if(t!=null&&t.phone_number)return this.formatPhoneNumber(t.phone_number);const{data:r}=await _.from("users").select("phone_number").eq("id",s).single();return r!=null&&r.phone_number?this.formatPhoneNumber(r.phone_number):null}catch(t){return console.error("Error getting user phone:",t),null}}}const Q=new Pe;class Fe{async sendEmailInvite({to:s,type:t,inviterName:r,groupName:a,groupId:n,amount:o,message:c}){try{if(t==="group"&&a)return await ae.sendGroupInvite({to:s,inviterName:r,groupName:a,groupId:n||"1",groupBalance:o||0,memberCount:8,personalMessage:c});{const l=this.generateEmailContent({type:t,inviterName:r,amount:o,message:c});return await ae.sendCustomEmail({to:s,subject:l.subject,htmlContent:l.html})}}catch(l){throw console.error("Error sending email invite:",l),l}}async sendSMSInvite({to:s,type:t,inviterName:r,groupName:a,groupId:n,amount:o,message:c}){try{const{data:{user:l}}=await _.auth.getUser();if(!l)throw new Error("User not authenticated");const w=Q.formatPhoneNumber(s),v=await this.generateInviteLink({type:t,groupId:n,amount:o});switch(t){case"group":if(!a)throw new Error("Group name required for group invites");await Q.sendGroupInviteSMS({inviteePhone:w,inviterName:r,groupName:a,inviteLink:v});break;case"money":const y=`Bankroll: ${r} sent you $${o}! ${c?`"${c.substring(0,40)}"`:""} Claim: ${v}`;await Q.sendSMS(w,y);break;case"freebet":const C=`Bankroll: ${r} sent you a $${o} free bet! ${c?`"${c.substring(0,30)}"`:""} Claim: ${v}`;await Q.sendSMS(w,C);break;default:const E=`Bankroll: ${r} invited you! Join: ${v}`;await Q.sendSMS(w,E)}return{success:!0,inviteLink:v}}catch(l){throw console.error("Error sending SMS invite:",l),l}}async generateInviteLink({type:s,groupId:t,amount:r}){var l;const a=le(),n=new URLSearchParams;s&&n.append("type",s),t&&n.append("group",t),r&&n.append("amount",r);const o=Math.random().toString(36).substring(2,8).toUpperCase();n.append("code",o);const{error:c}=await _.from("invite_codes").insert({code:o,type:s,group_id:t,amount:r,created_by:(l=(await _.auth.getUser()).data.user)==null?void 0:l.id,expires_at:new Date(Date.now()+7*24*60*60*1e3).toISOString()});return c&&console.error("Error storing invite code:",c),`${a}/invite/${o}`}generateInviteMessage({type:s,inviterName:t,groupName:r,amount:a}){const n=le();switch(s){case"group":return`${t} invited you to join ${r} on Bankroll! Join here: ${n}/invite?type=group`;case"money":return`${t} sent you $${a} on Bankroll! Claim it here: ${n}/invite?type=money`;case"freebet":return`${t} sent you a $${a} free bet on Bankroll! Claim it here: ${n}/invite?type=freebet`;case"gift":return`${t} sent you a gift on Bankroll! Open it here: ${n}/invite?type=gift`;default:return`You're invited to Bankroll! Join here: ${n}`}}generateEmailContent({type:s,inviterName:t,amount:r,message:a}){const n="https://bankroll.live";let o="",c="";switch(s){case"money":o=`${t} sent you $${r} on Bankroll`,c=`
          <h2>üíµ You've received money!</h2>
          <p>${t} sent you <strong>$${r}</strong> on Bankroll.</p>
          ${a?`<p><em>"${a}"</em></p>`:""}
          <a href="${n}/invite?type=money&amount=${r}" style="display: inline-block; padding: 12px 24px; background: #10b981; color: white; text-decoration: none; border-radius: 8px;">
            Claim Your Money
          </a>
        `;break;case"freebet":o=`${t} sent you a free bet on Bankroll`,c=`
          <h2>üéüÔ∏è You've received a free bet!</h2>
          <p>${t} sent you a <strong>$${r} free bet</strong> on Bankroll.</p>
          ${a?`<p><em>"${a}"</em></p>`:""}
          <a href="${n}/invite?type=freebet&amount=${r}" style="display: inline-block; padding: 12px 24px; background: #f59e0b; color: white; text-decoration: none; border-radius: 8px;">
            Claim Free Bet
          </a>
        `;break;case"gift":o=`${t} sent you a gift on Bankroll`,c=`
          <h2>üéÅ You've received a gift!</h2>
          <p>${t} sent you a gift on Bankroll.</p>
          ${a?`<p><em>"${a}"</em></p>`:""}
          <a href="${n}/invite?type=gift" style="display: inline-block; padding: 12px 24px; background: #ec4899; color: white; text-decoration: none; border-radius: 8px;">
            Open Your Gift
          </a>
        `;break;default:o=`${t} invited you to Bankroll`,c=`
          <h2>You're invited to Bankroll!</h2>
          <p>${t} wants you to join them on Bankroll.</p>
          ${a?`<p><em>"${a}"</em></p>`:""}
          <a href="${n}" style="display: inline-block; padding: 12px 24px; background: #7c3aed; color: white; text-decoration: none; border-radius: 8px;">
            Join Bankroll
          </a>
        `}return{subject:o,html:c}}}const Ae=new Fe,Te=({groupId:f,groupName:s,groupEmoji:t="üë•",inviterName:r,onClose:a})=>{const[n,o]=u.useState(""),[c,l]=u.useState(""),[w,v]=u.useState(!0),[y,C]=u.useState(!1),[E,p]=u.useState(!1),[I,H]=u.useState(!1),[L,Y]=u.useState(""),[q,k]=u.useState(!1);u.useEffect(()=>{B()},[f]);const B=async()=>{var d;try{v(!0);const S=Date.now().toString(36).substring(-4),O=Math.random().toString(36).substring(2,4).toUpperCase(),T=`${f.substring(0,4).toUpperCase()}${S}${O}`;l(T);const K=`${window.location.origin}/invite/${T}`;o(K);const V=I&&L?L:null,{data:{user:m}}=await _.auth.getUser();try{const{error:D}=await _.from("invite_codes").insert({code:T,type:"group",group_id:f,created_by:m==null?void 0:m.id,password:V,expires_at:new Date(Date.now()+2592e6).toISOString(),used:!1});if(D&&((d=D.message)!=null&&d.includes("password"))){console.log("Password column not found, trying without it");const{error:X}=await _.from("invite_codes").insert({code:T,type:"group",group_id:f,created_by:m==null?void 0:m.id,expires_at:new Date(Date.now()+30*24*60*60*1e3).toISOString(),used:!1});X&&console.error("Error storing invite code (retry):",X)}else D&&console.error("Error storing invite code:",D)}catch(D){console.error("Failed to store invite code:",D)}}catch(S){console.error("Error generating invite:",S),h.error("Failed to generate invite link")}finally{v(!1)}},R=async()=>{if(!n){h.error("No link to copy yet");return}try{await navigator.clipboard.writeText(n),C(!0),h.success("Invite link copied!"),setTimeout(()=>C(!1),2e3)}catch{h.error("Failed to copy link")}},J=()=>{const d=`You're invited to join ${s} on Bankroll`,S=`Hi there!

${r} has invited you to join "${s}" ${t} on Bankroll.

Click here to join: ${n}

Bankroll is a platform for managing group finances and fantasy sports betting with friends.

See you there!`,O=`mailto:?subject=${encodeURIComponent(d)}&body=${encodeURIComponent(S)}`;window.open(O,"_blank")},b=async()=>{const d=`${r} invited you to join "${s}" on Bankroll! Join here: ${n}`;if(navigator.share&&navigator.canShare&&navigator.canShare({text:d}))try{await navigator.share({title:`Join ${s} on Bankroll`,text:d})}catch(S){S.name!=="AbortError"&&(console.error("Error sharing:",S),window.open(`sms:?body=${encodeURIComponent(d)}`,"_blank"))}else window.open(`sms:?body=${encodeURIComponent(d)}`,"_blank")},G=async()=>{const d={title:`Join ${s} on Bankroll`,text:`${r} invited you to join "${s}"! Join here:`,url:n};try{navigator.share&&navigator.canShare&&navigator.canShare(d)?(p(!0),await navigator.share(d),h.success("Shared successfully!")):R()}catch(S){S.name!=="AbortError"&&(console.error("Error sharing:",S),h.error("Failed to share"))}finally{p(!1)}};return w?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-purple-600/20 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Le,{className:"w-10 h-10 text-purple-400"})}),e.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"Share Invite Link"}),e.jsxs("p",{className:"text-sm text-gray-400",children:["Anyone with this link can join your group",I?" with the password":""]})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-sm text-gray-400 font-medium",children:"Your Invite Link"}),e.jsx("p",{className:"text-xs text-gray-500",children:"(expires in 30 days)"})]}),e.jsx("div",{className:"bg-gray-900/50 rounded p-3 min-h-[2.5rem] flex items-center",children:n?e.jsx("p",{className:"text-sm text-gray-300 break-all font-mono select-all",children:n}):e.jsx("p",{className:"text-sm text-gray-500 italic",children:"Generating link..."})}),e.jsxs("p",{className:"text-xs text-gray-500 text-center mt-2",children:["Invite Code: ",e.jsx("span",{className:"text-purple-400 font-mono font-bold",children:c})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:I,onChange:d=>{H(d.target.checked),d.target.checked||Y("")},className:"w-4 h-4 text-purple-600 bg-gray-700 border-gray-600 rounded focus:ring-purple-500"}),e.jsx("span",{className:"text-sm text-gray-300",children:"Require password to join"})]})}),I&&e.jsxs("div",{className:"relative",children:[e.jsx(_e,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:q?"text":"password",value:L,onChange:d=>Y(d.target.value),placeholder:"Enter password",className:"w-full pl-10 pr-10 py-2 bg-gray-700/50 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-purple-500"}),e.jsx("button",{type:"button",onClick:()=>k(!q),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-white",children:q?e.jsx(fe,{className:"w-5 h-5"}):e.jsx(ye,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(j,{onClick:R,className:"w-full bg-purple-600 hover:bg-purple-700 text-white",children:y?e.jsxs(e.Fragment,{children:[e.jsx(be,{className:"w-4 h-4 mr-2"}),"Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(Be,{className:"w-4 h-4 mr-2"}),"Copy Link"]})}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs(j,{onClick:J,variant:"outline",className:"border-gray-600 text-gray-300 hover:bg-gray-800 text-sm font-medium",children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),"Email"]}),e.jsxs(j,{onClick:b,variant:"outline",className:"border-gray-600 text-gray-300 hover:bg-gray-800 text-sm font-medium",children:[e.jsx(te,{className:"w-4 h-4 mr-2"}),"Text"]}),e.jsxs(j,{onClick:G,variant:"outline",className:"border-gray-600 text-gray-300 hover:bg-gray-800 text-sm font-medium",disabled:E,children:[e.jsx(De,{className:"w-4 h-4 mr-2"}),"Share"]})]})]}),e.jsxs("div",{className:"bg-blue-900/20 border border-blue-800/30 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-blue-300",children:e.jsx("strong",{children:"How it works:"})}),e.jsxs("ul",{className:"mt-2 space-y-1 text-xs text-blue-200",children:[e.jsx("li",{children:"‚Ä¢ Anyone can use this link to view your group"}),e.jsx("li",{children:"‚Ä¢ New users will be prompted to sign up first"}),e.jsxs("li",{children:["‚Ä¢ ",I?"Users must enter the password to join":"Users can join immediately"]}),e.jsx("li",{children:"‚Ä¢ The link expires in 30 days"})]})]}),e.jsxs("div",{className:"flex justify-between pt-4",children:[e.jsx(j,{onClick:B,variant:"ghost",className:"text-gray-400 hover:text-white",disabled:I&&!L,children:"Generate New Link"}),a&&e.jsx(j,{onClick:a,className:"bg-gray-700 hover:bg-gray-600 text-white",children:"Done"})]})]})},Ve=({groupId:f,groupName:s,onClose:t,onInvite:r})=>{const[a,n]=u.useState(""),[o,c]=u.useState([]),[l,w]=u.useState([]),[v,y]=u.useState(!1),[C,E]=u.useState(!1),[p,I]=u.useState(null),[H,L]=u.useState(""),[Y,q]=u.useState(!1),[k,B]=u.useState("search"),[R,J]=u.useState(""),[b,G]=u.useState(!1),[d,S]=u.useState(""),[O,T]=u.useState(!1),[K,V]=u.useState(""),{currentUser:m}=we(),{getGroup:D}=ve();u.useEffect(()=>{(async()=>{try{const x=await D(f);I(x)}catch(x){console.error("Error fetching group:",x),h.error("Failed to load group details")}})()},[f,D]),u.useEffect(()=>{const i=f.substring(0,8);L(Se(i))},[f]),u.useEffect(()=>{m||(h.error("Please sign in to send invites"),t())},[m,t]);const X=async()=>{if(!a.trim()){c([]);return}E(!0);try{const i=await Re.searchUsers(a),x=new Set([...(p==null?void 0:p.memberIds)||[],...((p==null?void 0:p.members)||[]).map(N=>N.uid)]),g=i.filter(N=>!x.has(N.uid)&&N.uid!==m.uid);c(g)}catch(i){console.error("Error searching users:",i),h.error("Failed to search users")}finally{E(!1)}};u.useEffect(()=>{const i=setTimeout(()=>{a&&X()},300);return()=>clearTimeout(i)},[a]);const de=i=>{l.find(x=>x.uid===i.uid)||(w([...l,i]),n(""),c([]))},ue=i=>{w(l.filter(x=>x.uid!==i))},me=async()=>{if(l.length===0){h.error("Please select at least one user to invite");return}y(!0);try{const i=l.filter(g=>g.email).map(g=>g.email),x=l.filter(g=>g.phoneNumber).map(g=>g.phoneNumber);if(i.length>0){const g=await ae.sendBulkGroupInvites(f,s,i,(p==null?void 0:p.emoji)||"üë•",m);if(!g.success)throw new Error(g.message||"Failed to send email invites")}h.success(`Successfully invited ${l.length} users`),r(),t()}catch(i){console.error("Error sending invites:",i),h.error(i.message||"Failed to send invites")}finally{y(!1)}},he=async()=>{if(!R.trim()){h.error("Please enter at least one phone number");return}G(!0);try{const i=R.split(`
`).map(U=>U.trim()).filter(U=>U.length>0);if(i.length===0){h.error("Please enter at least one phone number");return}const x=/^\+?[1-9]\d{1,14}$/,g=i.filter(U=>!x.test(U.replace(/[\s\-\(\)]/g,"")));if(g.length>0){h.error(`Invalid phone number format: ${g[0]}`);return}let N=0,P=0;for(const U of i)try{await Ae.sendSMSInvite({to:U,type:"group",inviterName:m.displayName||m.email,groupName:s,groupId:f}),N++}catch(z){console.error(`Failed to send SMS to ${U}:`,z),P++}N>0&&h.success(`Successfully sent ${N} text invitation${N>1?"s":""}`),P>0&&h.error(`Failed to send ${P} invitation${P>1?"s":""}`),N>0&&(r(),t())}catch(i){console.error("Error sending SMS invites:",i),h.error("Failed to send text invitations")}finally{G(!1)}},pe=async()=>{var i;if(!d.trim()){h.error("Please enter at least one email address");return}T(!0);try{const x=d.split(`
`).map(M=>M.trim()).filter(M=>M.length>0);if(x.length===0){h.error("Please enter at least one email address");return}const g=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,N=x.filter(M=>!g.test(M));if(N.length>0){h.error(`Invalid email format: ${N[0]}`);return}const P=p||{emoji:"üë•",memberCount:1,balance:0},U=(await Ie(async()=>{const{default:M}=await import("./ResendInviteService-BnnlyYs3.js");return{default:M}},__vite__mapDeps([0,1,2]))).default;console.log("Sending email invites to:",x);const z=await U.sendBulkInvites({recipients:x,type:"group",inviteData:{inviterName:m.displayName||((i=m.email)==null?void 0:i.split("@")[0])||"Someone",inviterEmail:m.email,groupId:f,groupName:s,groupEmoji:P.emoji,groupBalance:P.balance||0,memberCount:P.memberCount||1,personalMessage:K,method:"email"}});console.log("Email invite result:",z);const Z=z.filter(M=>M.success).length,se=z.filter(M=>!M.success).length;Z>0&&h.success(`Successfully sent ${Z} email invitation${Z>1?"s":""}`),se>0&&h.error(`Failed to send ${se} invitation${se>1?"s":""}`),Z>0&&(S(""),V(""),r(),t())}catch(x){console.error("Error sending email invites:",x),h.error("Failed to send email invitations")}finally{T(!1)}},ne=()=>{r(),t()};return m?e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs(je,{className:"bg-gray-900/95 border-purple-500/20 w-full max-w-[500px] max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs(Ne,{className:"relative border-b border-gray-800 flex-shrink-0",children:[e.jsx("button",{onClick:t,className:"absolute right-4 top-4 text-gray-400 hover:text-white",children:e.jsx(ce,{className:"w-5 h-5"})}),e.jsxs(ke,{className:"text-xl font-bold text-white",children:["Add Members to ",s]}),e.jsxs("div",{className:"flex space-x-4 mt-4",children:[e.jsx("button",{onClick:()=>B("search"),className:`pb-2 px-1 text-sm font-medium border-b-2 transition-colors ${k==="search"?"text-purple-400 border-purple-400":"text-gray-400 border-transparent hover:text-white"}`,children:"Search Users"}),e.jsxs("button",{onClick:()=>B("email"),className:`pb-2 px-1 text-sm font-medium border-b-2 transition-colors ${k==="email"?"text-purple-400 border-purple-400":"text-gray-400 border-transparent hover:text-white"}`,children:[e.jsx(W,{className:"w-3 h-3 inline mr-1"}),"Email"]}),e.jsxs("button",{onClick:()=>B("sms"),className:`pb-2 px-1 text-sm font-medium border-b-2 transition-colors ${k==="sms"?"text-purple-400 border-purple-400":"text-gray-400 border-transparent hover:text-white"}`,children:[e.jsx(te,{className:"w-3 h-3 inline mr-1"}),"Text"]}),e.jsx("button",{onClick:()=>B("link"),className:`pb-2 px-1 text-sm font-medium border-b-2 transition-colors ${k==="link"?"text-purple-400 border-purple-400":"text-gray-400 border-transparent hover:text-white"}`,children:"Share Link"})]})]}),e.jsxs($e,{className:"p-6 overflow-y-auto flex-1",children:[k==="search"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ce,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(Ue,{type:"text",placeholder:"Search by username, email, or phone number...",value:a,onChange:i=>n(i.target.value),className:"pl-10 bg-gray-800 border-gray-700 text-white"})]}),C&&e.jsx("div",{className:"text-center py-4",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto"})}),o.length>0&&e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:o.map(i=>e.jsxs("div",{onClick:()=>de(i),className:"flex items-center justify-between p-3 bg-gray-800/50 rounded-lg hover:bg-gray-700/50 cursor-pointer transition-colors",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[i.photoURL?e.jsx("img",{src:i.photoURL,alt:i.displayName,className:"w-8 h-8 rounded-full"}):e.jsx("div",{className:"w-8 h-8 bg-purple-600 rounded-full flex items-center justify-center",children:e.jsx(Ee,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-medium",children:i.displayName||i.email}),e.jsxs("p",{className:"text-xs text-gray-400",children:[i.email&&e.jsxs("span",{className:"inline-flex items-center",children:[e.jsx(W,{className:"w-3 h-3 mr-1"}),i.email]}),i.phoneNumber&&e.jsxs("span",{className:"inline-flex items-center ml-2",children:[e.jsx(Me,{className:"w-3 h-3 mr-1"}),i.phoneNumber]})]})]})]}),e.jsx("button",{className:"text-purple-400 hover:text-purple-300 text-sm",children:"Add"})]},i.uid))}),l.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-300",children:["Selected Users (",l.length,")"]}),e.jsx("div",{className:"space-y-1 max-h-32 overflow-y-auto",children:l.map(i=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-purple-600/20 rounded-lg",children:[e.jsx("span",{className:"text-sm text-white",children:i.displayName||i.email}),e.jsx("button",{onClick:()=>ue(i.uid),className:"text-gray-400 hover:text-white",children:e.jsx(ce,{className:"w-4 h-4"})})]},i.uid))})]}),e.jsxs("div",{className:"flex justify-between pt-4",children:[e.jsx(j,{onClick:ne,variant:"ghost",className:"text-gray-400 hover:text-white",children:"Skip for Now"}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(j,{onClick:t,className:"border-gray-700 text-gray-300 hover:bg-gray-800",children:"Cancel"}),e.jsx(j,{onClick:me,disabled:v||l.length===0,className:"bg-purple-600 hover:bg-purple-700 text-white",children:v?"Sending...":`Send Invites (${l.length})`})]})]})]}),k==="sms"&&e.jsxs("div",{className:"space-y-4 h-full flex flex-col",children:[e.jsxs("div",{className:"text-center py-4 flex-shrink-0",children:[e.jsx("div",{className:"w-16 h-16 bg-purple-600/20 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(te,{className:"w-8 h-8 text-purple-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Send Text Invitations"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Invite friends to your group via SMS"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm text-gray-400",children:"Phone Numbers"}),e.jsx("textarea",{placeholder:`Enter phone numbers, one per line
+1234567890
+9876543210`,value:R,onChange:i=>J(i.target.value),className:"w-full min-h-[120px] px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent resize-none",rows:5}),e.jsx("p",{className:"text-xs text-gray-500",children:"Include country code (e.g., +1 for US). One number per line."})]}),e.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-xs text-gray-400 mb-2",children:"Message Preview:"}),e.jsxs("p",{className:"text-sm text-gray-300",children:["Bankroll: ",(m==null?void 0:m.displayName)||"Someone",' invited you to join "',s,'". Join now: [link]']})]})]}),e.jsxs("div",{className:"flex justify-between pt-4 flex-shrink-0 border-t border-gray-800 mt-4",children:[e.jsx(j,{onClick:ne,variant:"ghost",className:"text-gray-400 hover:text-white",children:"Skip for Now"}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(j,{onClick:t,className:"border-gray-700 text-gray-300 hover:bg-gray-800",children:"Cancel"}),e.jsxs(j,{onClick:he,disabled:b||!R.trim(),className:"bg-purple-600 hover:bg-purple-700 text-white",children:[e.jsx(te,{className:"w-4 h-4 mr-2"}),b?"Sending...":"Send Text Invites"]})]})]})]}),k==="email"&&e.jsxs("div",{className:"space-y-4 h-full flex flex-col",children:[e.jsxs("div",{className:"text-center py-4 flex-shrink-0",children:[e.jsx("div",{className:"w-16 h-16 bg-purple-600/20 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(W,{className:"w-8 h-8 text-purple-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Send Email Invitations"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Invite friends to your group via email"})]}),e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Email Addresses"}),e.jsx("textarea",{placeholder:`Enter email addresses (one per line)
john@example.com
jane@example.com`,value:d,onChange:i=>S(i.target.value),className:"w-full p-3 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-500 resize-none h-32"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Enter multiple emails, one per line"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Personal Message (Optional)"}),e.jsx("textarea",{placeholder:"Add a personal message to your invitation...",value:K,onChange:i=>V(i.target.value),className:"w-full p-3 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-500 resize-none h-20"})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-4 flex-shrink-0",children:[e.jsx("div",{className:"text-sm text-gray-400",children:d.trim()&&e.jsxs("span",{children:[d.trim().split(`
`).filter(i=>i.trim()).length," email(s)"]})}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(j,{onClick:t,className:"border-gray-700 text-gray-300 hover:bg-gray-800",children:"Cancel"}),e.jsxs(j,{onClick:pe,disabled:O||!d.trim(),className:"bg-purple-600 hover:bg-purple-700 text-white",children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),O?"Sending...":"Send Email Invites"]})]})]})]}),k==="link"&&e.jsx(Te,{groupId:f,groupName:s,groupEmoji:p==null?void 0:p.emoji,inviterName:(m==null?void 0:m.displayName)||(m==null?void 0:m.email),onClose:null})]})]})}):null};export{Ve as I};
