import{a7 as ge,e as C,f as v,q as U,o as I,g as G,i as L,l as ve,aN as q,h as K,k as Z,aK as O,P as W,Y as V,aT as ye,a_ as we,a$ as Se,az as ee,b0 as me,r as j,j as e,c as se,x as Ae,U as z,aI as Te,b1 as ke,R as oe,B as fe,aL as De,aM as Q,X as je,D as Y,m as ae,S as J,I as de,N as Ce,C as Me,d as Ee,aH as xe,T as be,u as Pe}from"./main-Bt21LLck.js";import{C as re}from"./circle-check-big-PbtGHC_l.js";import{C as ne}from"./clock-Bf45bXE_.js";import{C as ie}from"./circle-x-Ch5ljYmC.js";import{M as Ue}from"./mail-Dke56W7c.js";import{M as Ge}from"./message-square-Wx_HBuIi.js";import{W as Le}from"./WinnersManager-CpMPE0c3.js";import{U as Fe,a as $e}from"./UserManagement-BNrTIWiB.js";import{I as Ie}from"./info-2jzgaFUs.js";import{A as le}from"./activity-rhRbEMqz.js";import{T as Be}from"./triangle-alert-BHLbSyoS.js";import{B as Re}from"./bar-chart-3-CCCVoHVg.js";import{D as Ne}from"./download-CwePtl3-.js";import{E as Oe}from"./ellipsis-vertical-CNMPpEyx.js";import{A as We}from"./arrow-up-right-DQDCwTvG.js";import{A as He}from"./arrow-down-right-DEPCSBqA.js";import{C as qe}from"./credit-card-ubWgKOyE.js";import{L as Ve}from"./log-out-D1nti5kR.js";import"./plus-Dh4NC-lY.js";import"./save-CdP6NBoK.js";import"./pen-DhCsUpBA.js";import"./trash-2-CaBEjahI.js";/**
 * @license lucide-react v0.363.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=ge("Archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]);/**
 * @license lucide-react v0.363.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=ge("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]),ue="adminSettings",pe="notifications",X="notificationRules",ce={saveAdminSettings:async(a,s)=>{try{const t=L(v,ue,a);return await ye(t,s,{merge:!0}),{success:!0}}catch(t){throw console.error("Error saving admin settings:",t),t}},getAdminSettings:async a=>{try{const s=L(v,ue,a),t=await V(s);return t.exists()?t.data():{}}catch(s){throw console.error("Error getting admin settings:",s),s}},getAllUsers:async()=>{try{console.log("Fetching all users for admin panel");const a=C(v,"users"),s=U(a,I("createdAt","desc"));return(await G(s)).docs.map(r=>{var i,d,x,m;const n=r.data();return{id:r.id,...n,createdAt:n.createdAt instanceof Date?n.createdAt:(d=(i=n.createdAt)==null?void 0:i.toDate)==null?void 0:d.call(i),lastSeen:n.lastSeen instanceof Date?n.lastSeen:(m=(x=n.lastSeen)==null?void 0:x.toDate)==null?void 0:m.call(x)}})}catch(a){throw console.error("Error fetching users for admin panel:",a),a}},getUsers:async(a={})=>{try{const{sortBy:s="createdAt",sortDirection:t="desc",limit:r=50,filter:n=null}=a,i=C(v,"users");let d=U(i,I(s,t),O(r));return n&&n.field&&n.value&&(d=U(d,W(n.field,n.operator||"==",n.value))),(await G(d)).docs.map(m=>{var g,b,c,h;const o=m.data();return{id:m.id,...o,createdAt:o.createdAt instanceof Date?o.createdAt:(b=(g=o.createdAt)==null?void 0:g.toDate)==null?void 0:b.call(g),lastSeen:o.lastSeen instanceof Date?o.lastSeen:(h=(c=o.lastSeen)==null?void 0:c.toDate)==null?void 0:h.call(c)}})}catch(s){throw console.error("Error fetching filtered users:",s),s}},getAdminStats:async()=>{try{const a=await ce.getAllUsers(),s={totalUsers:a.length,totalReferrals:a.reduce((t,r)=>{var n;return t+(((n=r.referrals)==null?void 0:n.length)||0)},0),totalLeagues:a.reduce((t,r)=>{var n;return t+(((n=r.leagues)==null?void 0:n.length)||0)},0),emailSubscribed:a.filter(t=>t.emailSubscribed).length,activePlatforms:{}};return a.forEach(t=>{t.platformConnections&&Object.keys(t.platformConnections).forEach(r=>{s.activePlatforms[r]||(s.activePlatforms[r]=0),s.activePlatforms[r]++})}),s}catch(a){throw console.error("Error getting admin stats:",a),a}},getNotificationsHistory:async(a={})=>{try{const{limit:s=100,type:t=null}=a,r=C(v,pe);let n=U(r,I("createdAt","desc"),O(s));return t&&(n=U(n,W("type","==",t))),(await G(n)).docs.map(d=>{var m,o,g,b,c,h;const x=d.data();return{id:d.id,...x,createdAt:(o=(m=x.createdAt)==null?void 0:m.toDate)==null?void 0:o.call(m),sentAt:(b=(g=x.sentAt)==null?void 0:g.toDate)==null?void 0:b.call(g),scheduledFor:(h=(c=x.scheduledFor)==null?void 0:c.toDate)==null?void 0:h.call(c)}})}catch(s){return console.error("Error fetching notifications history:",s),[]}},createNotification:async a=>{try{const{title:s,body:t,type:r,recipientType:n,recipientIds:i,scheduled:d,sendAt:x}=a;if(!s||!t||!r)throw new Error("Missing required notification fields");const m={title:s,body:t,type:r,recipientType:n,status:d?"scheduled":"pending",createdAt:q()};n==="individual"&&(m.recipientIds=i||[]),d&&x?(m.scheduled=!0,m.scheduledFor=new Date(x)):m.scheduledFor=q();const o=await Z(C(v,pe),m);return d||await K(o,{status:"sent",sentAt:q()}),{id:o.id,...m}}catch(s){throw console.error("Error creating notification:",s),s}},getNotificationRules:async()=>{try{const a=C(v,X),s=U(a,I("createdAt","desc"));return(await G(s)).docs.map(r=>{var n,i,d,x;return{id:r.id,...r.data(),createdAt:(i=(n=r.data().createdAt)==null?void 0:n.toDate)==null?void 0:i.call(n),updatedAt:(x=(d=r.data().updatedAt)==null?void 0:d.toDate)==null?void 0:x.call(d)}})}catch(a){return console.error("Error fetching notification rules:",a),[]}},createNotificationRule:async a=>{try{const{event:s,notificationType:t,templateName:r,description:n,active:i=!0}=a;if(!s||!t)throw new Error("Missing required rule fields");const d={event:s,notificationType:t,templateName:r||null,description:n||`Send ${t} notifications for ${s} events`,active:i,createdAt:q(),updatedAt:q()};return{id:(await Z(C(v,X),d)).id,...d}}catch(s){throw console.error("Error creating notification rule:",s),s}},updateNotificationRule:async(a,s)=>{try{const t=L(v,X,a),{id:r,...n}=s,i={...n,updatedAt:q()};return await K(t,i),{id:a,...i}}catch(t){throw console.error(`Error updating notification rule ${a}:`,t),t}},deleteNotificationRule:async a=>{try{const s=L(v,X,a);return await ve(s),{success:!0}}catch(s){throw console.error(`Error deleting notification rule ${a}:`,s),s}}};class Ye{constructor(){this.db=we(Se),this.baseUrl="https://us-central1-bankroll-2ccb4.cloudfunctions.net"}async sendNotification(s,t,r=["push"],n={}){try{const d=ee().currentUser;if(!d)throw new Error("User must be authenticated to send notifications");const x=await this.getUserNotificationPreferences(s),m=r.filter(b=>{switch(b){case"sms":return x.sms&&x.phone;case"email":return x.email&&x.emailAddress;case"push":return x.inApp&&x.pushToken;default:return!1}});if(m.length===0)throw new Error("No enabled notification channels for this user");const o={},g=await d.getIdToken(!0);for(const b of m)try{switch(b){case"sms":o.sms=await this.sendSMS(s,t,g);break;case"email":o.email=await this.sendEmail(s,t,g);break;case"push":o.push=await this.sendPushNotification(s,t,g);break}}catch(c){console.error(`Failed to send ${b} notification:`,c),o[b]={success:!1,error:c.message}}return await this.storeNotificationRecord(s,{...t,channels:m,results:o,timestamp:new Date,senderId:d.uid}),{success:!0,channels:m,results:o}}catch(i){throw console.error("Error sending unified notification:",i),i}}async sendSMS(s,t,r){const n=await fetch(`${this.baseUrl}/sendSMS`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({userId:s,message:t.body||t.message,type:t.type||"general"})});if(!n.ok){const i=await n.json();throw new Error(i.error||"Failed to send SMS")}return await n.json()}async sendEmail(s,t,r){const n=await fetch(`${this.baseUrl}/sendEmail`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({userId:s,emailType:t.type||"general",templateName:t.templateName||"general",templateData:{subject:t.title||"Notification from Bankroll",message:t.body||t.message,...t.templateData}})});if(!n.ok){const i=await n.json();throw new Error(i.error||"Failed to send email")}return await n.json()}async sendPushNotification(s,t,r){return await me.sendNotification(s,{title:t.title,body:t.body||t.message,data:t.data||{}})}async getUserNotificationPreferences(s){try{const t=await V(L(this.db,"userPreferences",s)),r=await V(L(this.db,"users",s));if(!t.exists()||!r.exists())return{inApp:!0,sms:!1,email:!1,pushToken:null,phone:null,emailAddress:null};const n=t.data().notifications||{},i=r.data();return{...n,phone:i.phone,emailAddress:i.email}}catch(t){throw console.error("Error getting notification preferences:",t),t}}async updateNotificationPreferences(s,t){try{return await ye(L(this.db,"userPreferences",s),{notifications:t},{merge:!0}),{success:!0}}catch(r){throw console.error("Error updating notification preferences:",r),r}}async storeNotificationRecord(s,t){try{await Z(C(this.db,"notificationHistory"),{userId:s,...t})}catch(r){console.error("Error storing notification record:",r)}}async sendBulkNotification(s,t,r=["push"],n={}){const i={};for(const d of s)try{i[d]=await this.sendNotification(d,t,r,n)}catch(x){i[d]={success:!1,error:x.message}}return i}async testNotification(s,t="push"){const r={title:"Test Notification",body:"This is a test notification from Bankroll",type:"test"};return await this.sendNotification(s,r,[t])}async sendEmail(s,t,r){try{const i=ee().currentUser;if(!i)throw new Error("User must be authenticated to send emails");const d=await i.getIdToken(!0),x=await fetch(`${this.baseUrl}/sendAdminEmail`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${d}`},body:JSON.stringify({to:s,subject:t,body:r,html:`<div style="font-family: Arial, sans-serif; padding: 20px;">
            <h2>${t}</h2>
            <p>${r}</p>
            <hr />
            <p style="color: #666; font-size: 12px;">Sent from Bankroll Admin Panel</p>
          </div>`})});if(!x.ok)throw new Error(`Email sending failed: ${x.statusText}`);return{success:!0,channel:"email",recipient:s}}catch(n){return console.error("Error sending email:",n),{success:!1,error:n.message}}}async sendSMS(s,t){try{const n=ee().currentUser;if(!n)throw new Error("User must be authenticated to send SMS");const i=await n.getIdToken(!0),d=await fetch(`${this.baseUrl}/sendAdminSMS`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify({to:s,message:t})});if(!d.ok)throw new Error(`SMS sending failed: ${d.statusText}`);return{success:!0,channel:"sms",recipient:s}}catch(r){return console.error("Error sending SMS:",r),{success:!1,error:r.message}}}async sendPushNotification(s,t,r){try{return await me.createNotification({userId:s,title:t,body:r,type:"admin",actionUrl:null,metadata:{sentFromAdmin:!0}}),{success:!0,channel:"push",recipient:s}}catch(n){return console.error("Error sending push notification:",n),{success:!1,error:n.message}}}async getNotificationHistory(s,t=50){try{return(await G(U(C(this.db,"notificationHistory"),W("userId","==",s),I("timestamp","desc"),t(t)))).docs.map(n=>({id:n.id,...n.data()}))}catch(r){throw console.error("Error getting notification history:",r),r}}}const te=new Ye,_e=()=>{const[a,s]=j.useState("send"),[t,r]=j.useState(!1),[n,i]=j.useState([]),[d,x]=j.useState(!0),[m,o]=j.useState([]),[g,b]=j.useState([]),[c,h]=j.useState({title:"",message:"",channels:["push"],recipientType:"all",specificRecipients:"",testRecipients:{email:"",phone:""}}),[u,N]=j.useState({totalSent:0,successRate:0,pendingCount:0,failedCount:0});j.useEffect(()=>{M(),T(),E()},[]);const T=async()=>{try{const y=(await G(C(v,"users"))).docs.map(S=>({id:S.id,...S.data()}));b(y)}catch(l){console.error("Error loading users:",l)}},M=async()=>{try{const l=U(C(v,"notificationHistory"),I("createdAt","desc"),O(50)),S=(await G(l)).docs.map(A=>({id:A.id,...A.data()}));i(S)}catch(l){console.error("Error loading notification history:",l)}},E=async()=>{try{const y=(await G(C(v,"notificationHistory"))).docs.map(F=>F.data()),S=y.length,A=y.filter(F=>F.status==="sent"||F.status==="delivered").length,P=y.filter(F=>F.status==="pending").length,B=y.filter(F=>F.status==="failed").length;N({totalSent:S,successRate:S>0?Math.round(A/S*100):0,pendingCount:P,failedCount:B})}catch(l){console.error("Error loading stats:",l)}},f=async l=>{l.preventDefault(),r(!0);try{const y=w();if(y.length===0){alert("No recipients selected"),r(!1);return}for(const S of c.channels)for(const A of y){let P;if(d)await new Promise(B=>setTimeout(B,500)),P={success:Math.random()>.1,channel:S,recipient:A.email||A.phoneNumber||A.id,messageId:`test_${Date.now()}_${Math.random()}`};else switch(S){case"email":A.email&&(P=await te.sendEmail(A.email,c.title,c.message));break;case"sms":A.phoneNumber&&(P=await te.sendSMS(A.phoneNumber,c.message));break;case"push":P=await te.sendPushNotification(A.id,c.title,c.message);break}await Z(C(v,"notificationHistory"),{title:c.title,message:c.message,channel:S,recipientId:A.id,recipientEmail:A.email,recipientPhone:A.phoneNumber,status:P!=null&&P.success?"sent":"failed",testMode:d,createdAt:q(),metadata:P})}h({...c,title:"",message:"",specificRecipients:""}),await M(),await E(),alert("Notifications sent successfully!")}catch(y){console.error("Error sending notifications:",y),alert("Error sending notifications: "+y.message)}finally{r(!1)}},w=()=>{if(c.recipientType==="all")return g;if(c.recipientType==="selected")return m;if(c.recipientType==="test"){const l=[];return c.testRecipients.email&&l.push({id:"test-email",email:c.testRecipients.email}),c.testRecipients.phone&&l.push({id:"test-phone",phoneNumber:c.testRecipients.phone}),l}return[]},k=l=>l?(l.toDate?l.toDate():new Date(l)).toLocaleString():"N/A";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Notification Center"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Send and manage notifications to your users"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:d,onChange:l=>x(l.target.checked),className:"rounded"}),e.jsx("span",{children:"Test Mode"})]}),d&&e.jsx("span",{className:"text-xs text-orange-600 bg-orange-100 px-2 py-1 rounded",children:"Notifications will be simulated"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Sent"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:u.totalSent})]}),e.jsx(se,{className:"h-8 w-8 text-blue-500"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Success Rate"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[u.successRate,"%"]})]}),e.jsx(re,{className:"h-8 w-8 text-green-500"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Pending"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:u.pendingCount})]}),e.jsx(ne,{className:"h-8 w-8 text-orange-500"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Failed"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:u.failedCount})]}),e.jsx(ie,{className:"h-8 w-8 text-red-500"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"flex -mb-px",children:[e.jsx("button",{onClick:()=>s("send"),className:`px-6 py-3 text-sm font-medium ${a==="send"?"border-b-2 border-blue-500 text-blue-600":"text-gray-500 hover:text-gray-700"}`,children:"Send Notification"}),e.jsx("button",{onClick:()=>s("history"),className:`px-6 py-3 text-sm font-medium ${a==="history"?"border-b-2 border-blue-500 text-blue-600":"text-gray-500 hover:text-gray-700"}`,children:"History"})]})}),e.jsx("div",{className:"p-6",children:a==="send"?e.jsxs("form",{onSubmit:f,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notification Title"}),e.jsx("input",{type:"text",value:c.title,onChange:l=>h({...c,title:l.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter notification title",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Message"}),e.jsx("textarea",{value:c.message,onChange:l=>h({...c,message:l.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",rows:4,placeholder:"Enter your message here...",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notification Channels"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:c.channels.includes("push"),onChange:l=>{l.target.checked?h({...c,channels:[...c.channels,"push"]}):h({...c,channels:c.channels.filter(y=>y!=="push")})},className:"rounded"}),e.jsx(Ae,{className:"h-4 w-4"}),e.jsx("span",{children:"Push Notification"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:c.channels.includes("email"),onChange:l=>{l.target.checked?h({...c,channels:[...c.channels,"email"]}):h({...c,channels:c.channels.filter(y=>y!=="email")})},className:"rounded"}),e.jsx(Ue,{className:"h-4 w-4"}),e.jsx("span",{children:"Email"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:c.channels.includes("sms"),onChange:l=>{l.target.checked?h({...c,channels:[...c.channels,"sms"]}):h({...c,channels:c.channels.filter(y=>y!=="sms")})},className:"rounded"}),e.jsx(Ge,{className:"h-4 w-4"}),e.jsx("span",{children:"SMS"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Recipients"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"recipientType",value:"all",checked:c.recipientType==="all",onChange:l=>h({...c,recipientType:l.target.value})}),e.jsx(z,{className:"h-4 w-4"}),e.jsxs("span",{children:["All Users (",g.length,")"]})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"recipientType",value:"test",checked:c.recipientType==="test",onChange:l=>h({...c,recipientType:l.target.value})}),e.jsx(Te,{className:"h-4 w-4"}),e.jsx("span",{children:"Test Recipients"})]})]})]}),c.recipientType==="test"&&e.jsxs("div",{className:"space-y-4 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Test Email"}),e.jsx("input",{type:"email",value:c.testRecipients.email,onChange:l=>h({...c,testRecipients:{...c.testRecipients,email:l.target.value}}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"test@example.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Test Phone Number"}),e.jsx("input",{type:"tel",value:c.testRecipients.phone,onChange:l=>h({...c,testRecipients:{...c.testRecipients,phone:l.target.value}}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"+1234567890"})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",disabled:t||c.channels.length===0,className:"flex items-center gap-2 px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed",children:t?e.jsxs(e.Fragment,{children:[e.jsx(ke,{className:"h-4 w-4 animate-spin"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"h-4 w-4"}),"Send Notification"]})})})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Notification History"}),e.jsxs("button",{onClick:M,className:"flex items-center gap-2 px-4 py-2 text-sm text-gray-600 hover:text-gray-900",children:[e.jsx(oe,{className:"h-4 w-4"}),"Refresh"]})]}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Title"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Channel"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Recipient"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Mode"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:n.map(l=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:k(l.createdAt)}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:l.title||"N/A"}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${l.channel==="email"?"bg-blue-100 text-blue-800":l.channel==="sms"?"bg-green-100 text-green-800":"bg-purple-100 text-purple-800"}`,children:l.channel})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:l.recipientEmail||l.recipientPhone||"User"}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("span",{className:`inline-flex items-center gap-1 ${l.status==="sent"||l.status==="delivered"?"text-green-600":l.status==="failed"?"text-red-600":"text-orange-600"}`,children:[l.status==="sent"||l.status==="delivered"?e.jsx(re,{className:"h-4 w-4"}):l.status==="failed"?e.jsx(ie,{className:"h-4 w-4"}):e.jsx(ne,{className:"h-4 w-4"}),l.status]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:l.testMode&&e.jsx("span",{className:"text-xs text-orange-600 bg-orange-100 px-2 py-1 rounded",children:"Test"})})]},l.id))})]}),n.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(fe,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No notifications sent yet"})]})]})]})})]})]})};class Ke{constructor(){this.groupsCollection="groups",this.usersCollection="users",this.transactionsCollection="transactions"}async getGroupsPaginated(s=50,t=null){try{let r=U(C(v,this.groupsCollection),I("createdAt","desc"),O(s));t&&(r=U(C(v,this.groupsCollection),I("createdAt","desc"),De(t),O(s)));const n=await G(r),i=[];for(const d of n.docs){const x=d.data(),m=await this.enrichGroupData(d.id,x);i.push(m)}return{groups:i,lastDoc:n.docs[n.docs.length-1],hasMore:n.docs.length===s}}catch(r){throw console.error("Error fetching groups:",r),r}}async enrichGroupData(s,t){var r;try{const n=await this.getGroupMembers(s,t.members||[]),i=await this.getGroupActivitySummary(s),d=this.calculateGroupAge(t.createdAt),x=this.determineGroupType(t),m=await this.getGroupFinancialSummary(s,t.members||[]);return{id:s,...t,name:t.name||"Unnamed Group",description:t.description||"",type:x.type,platform:x.platform,platformDetails:x.details,createdAt:t.createdAt||Q.now(),createdBy:t.createdBy||"Unknown",memberCount:((r=t.members)==null?void 0:r.length)||0,memberDetails:n,inviteCode:t.inviteCode||"",privacy:t.privacy||"private",status:this.getGroupStatus(t),groupAge:d,activity:i,financials:m,settings:{autoSplit:t.autoSplit||!1,weeklyDues:t.weeklyDues||0,defaultSplitPercentage:t.defaultSplitPercentage||100,allowGuestBets:t.allowGuestBets||!1},leagues:t.leagues||[],tags:t.tags||[],lastActive:t.lastActive||t.createdAt}}catch(n){return console.error("Error enriching group data:",n),{id:s,...t,error:"Failed to load complete data"}}}determineGroupType(s){var r,n,i;const t={sleeper:{type:"Fantasy League",platform:"Sleeper",icon:"🏈",color:"purple"},espn:{type:"Fantasy League",platform:"ESPN",icon:"🏀",color:"red"},yahoo:{type:"Fantasy League",platform:"Yahoo",icon:"⚾",color:"purple"},draftkings:{type:"DFS Group",platform:"DraftKings",icon:"👑",color:"orange"},fanduel:{type:"DFS Group",platform:"FanDuel",icon:"⚡",color:"blue"},betting:{type:"Betting Syndicate",platform:"Multiple",icon:"💰",color:"green"},social:{type:"Social Group",platform:"Bankroll",icon:"👥",color:"gray"}};return s.sleeperLeagueId||s.platform==="sleeper"?{...t.sleeper,details:{leagueId:s.sleeperLeagueId}}:s.espnLeagueId||s.platform==="espn"?{...t.espn,details:{leagueId:s.espnLeagueId}}:s.yahooLeagueId||s.platform==="yahoo"?{...t.yahoo,details:{leagueId:s.yahooLeagueId}}:s.platform==="draftkings"||(r=s.tags)!=null&&r.includes("dfs")?{...t.draftkings,details:{}}:s.platform==="fanduel"?{...t.fanduel,details:{}}:(n=s.tags)!=null&&n.includes("betting")||(i=s.tags)!=null&&i.includes("sportsbook")?{...t.betting,details:{}}:{...t.social,details:{}}}async getGroupMembers(s,t){var r,n,i,d,x,m;try{if(!t||t.length===0)return[];const o=[];for(const g of t.slice(0,10))try{const b=await V(L(v,this.usersCollection,g));if(b.exists()){const c=b.data();o.push({id:g,username:c.username||"Unknown",email:c.email||"",joinedAt:((n=(r=c.groups)==null?void 0:r[s])==null?void 0:n.joinedAt)||null,role:((d=(i=c.groups)==null?void 0:i[s])==null?void 0:d.role)||"member",balance:(((x=c.balance)==null?void 0:x.cash)||0)+(((m=c.balance)==null?void 0:m.bonus)||0)})}}catch(b){console.error(`Error fetching member ${g}:`,b)}return o}catch(o){return console.error("Error getting group members:",o),[]}}async getGroupActivitySummary(s){try{const t=new Date,r=new Date(t.getTime()-24*60*60*1e3),n=new Date(t.getTime()-7*24*60*60*1e3),i=new Date(t.getTime()-30*24*60*60*1e3),d=U(C(v,this.transactionsCollection),W("groupId","==",s),I("createdAt","desc"),O(100)),m=(await G(d)).docs.map(g=>({id:g.id,...g.data()})),o={totalTransactions:m.length,last24Hours:0,lastWeek:0,lastMonth:0,totalVolume:0,lastTransaction:null,activeMembers:new Set,transactionTypes:{bets:0,dues:0,payouts:0,other:0}};return m.forEach(g=>{var c,h,u,N;const b=((c=g.createdAt)==null?void 0:c.toDate())||new Date(g.createdAt);b>=r&&o.last24Hours++,b>=n&&o.lastWeek++,b>=i&&o.lastMonth++,o.totalVolume+=Math.abs(g.amount||0),o.activeMembers.add(g.userId),g.type==="bet"||(h=g.description)!=null&&h.includes("bet")?o.transactionTypes.bets++:g.type==="dues"||(u=g.description)!=null&&u.includes("dues")?o.transactionTypes.dues++:g.type==="payout"||(N=g.description)!=null&&N.includes("payout")?o.transactionTypes.payouts++:o.transactionTypes.other++}),o.activeMembers=o.activeMembers.size,o.lastTransaction=m[0]||null,o}catch(t){return console.error("Error getting group activity:",t),{totalTransactions:0,last24Hours:0,lastWeek:0,lastMonth:0,totalVolume:0,lastTransaction:null,activeMembers:0,transactionTypes:{bets:0,dues:0,payouts:0,other:0}}}}async getGroupFinancialSummary(s,t){var r,n;try{const i={totalPoolBalance:0,totalMemberBalances:0,totalInflows:0,totalOutflows:0,pendingDues:0,upcomingPayouts:0},d=await V(L(v,this.groupsCollection,s));if(d.exists()){const x=d.data();i.totalPoolBalance=x.poolBalance||0,i.pendingDues=x.pendingDues||0,i.upcomingPayouts=x.upcomingPayouts||0}for(const x of t)try{const m=await V(L(v,this.usersCollection,x));if(m.exists()){const o=m.data();i.totalMemberBalances+=(((r=o.balance)==null?void 0:r.cash)||0)+(((n=o.balance)==null?void 0:n.bonus)||0)}}catch(m){console.error(`Error fetching member balance ${x}:`,m)}return i}catch(i){return console.error("Error getting financial summary:",i),{totalPoolBalance:0,totalMemberBalances:0,totalInflows:0,totalOutflows:0,pendingDues:0,upcomingPayouts:0}}}calculateGroupAge(s){if(!s)return"Unknown";const t=s.toDate?s.toDate():new Date(s),n=new Date-t,i=Math.floor(n/(1e3*60*60*24));return i<1?"Today":i===1?"1 day":i<30?`${i} days`:i<365?`${Math.floor(i/30)} months`:`${Math.floor(i/365)} years`}getGroupStatus(s){var n;if(s.archived)return"archived";if(s.suspended)return"suspended";const t=(n=s.lastActive)!=null&&n.toDate?s.lastActive.toDate():new Date(s.lastActive||0),r=Math.floor((new Date-t)/(1e3*60*60*24));return r>30?"dormant":r>7?"inactive":"active"}async searchGroups(s){try{const t=[],r=U(C(v,this.groupsCollection),W("name",">=",s),W("name","<=",s+""),O(20));(await G(r)).forEach(m=>{t.push({id:m.id,...m.data()})});const i=U(C(v,this.groupsCollection),W("inviteCode","==",s));(await G(i)).forEach(m=>{t.find(o=>o.id===m.id)||t.push({id:m.id,...m.data()})});const x=[];for(const m of t){const o=await this.enrichGroupData(m.id,m);x.push(o)}return x}catch(t){throw console.error("Error searching groups:",t),t}}async updateGroupStatus(s,t){try{const r=L(v,this.groupsCollection,s);return await K(r,{status:t,statusUpdatedAt:Q.now(),statusUpdatedBy:"admin"}),!0}catch(r){throw console.error("Error updating group status:",r),r}}async archiveGroup(s){try{const t=L(v,this.groupsCollection,s);return await K(t,{archived:!0,archivedAt:Q.now(),archivedBy:"admin"}),!0}catch(t){throw console.error("Error archiving group:",t),t}}async unarchiveGroup(s){try{const t=L(v,this.groupsCollection,s);return await K(t,{archived:!1,unarchivedAt:Q.now(),unarchivedBy:"admin"}),!0}catch(t){throw console.error("Error unarchiving group:",t),t}}async getGroupStatistics(){try{const s=await G(C(v,this.groupsCollection)),t={total:s.size,active:0,inactive:0,dormant:0,archived:0,byPlatform:{sleeper:0,espn:0,yahoo:0,draftkings:0,fanduel:0,bankroll:0,other:0},byType:{fantasy:0,dfs:0,betting:0,social:0},totalMembers:0,averageMembers:0,newToday:0,newThisWeek:0,newThisMonth:0},r=new Date,n=new Date(r.getFullYear(),r.getMonth(),r.getDate()),i=new Date(n.getTime()-7*24*60*60*1e3),d=new Date(n.getTime()-30*24*60*60*1e3);return s.forEach(x=>{var u,N;const m=x.data(),o=this.determineGroupType(m),g=this.getGroupStatus(m);g==="active"?t.active++:g==="inactive"?t.inactive++:g==="dormant"?t.dormant++:g==="archived"&&t.archived++;const b=o.platform.toLowerCase();t.byPlatform[b]!==void 0?t.byPlatform[b]++:t.byPlatform.other++,o.type.includes("Fantasy")?t.byType.fantasy++:o.type.includes("DFS")?t.byType.dfs++:o.type.includes("Betting")?t.byType.betting++:t.byType.social++;const c=((u=m.members)==null?void 0:u.length)||0;t.totalMembers+=c;const h=(N=m.createdAt)!=null&&N.toDate?m.createdAt.toDate():new Date(m.createdAt);h>=n&&t.newToday++,h>=i&&t.newThisWeek++,h>=d&&t.newThisMonth++}),t.averageMembers=t.total>0?Math.round(t.totalMembers/t.total):0,t}catch(s){throw console.error("Error getting group statistics:",s),s}}}const _=new Ke,Je=({group:a,onClose:s,onAction:t})=>{const[r,n]=j.useState("overview");if(!a)return null;const i=h=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(h||0),d=h=>h?(h.toDate?h.toDate():new Date(h)).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A",x=h=>({Sleeper:"🏈",ESPN:"🏀",Yahoo:"⚾",DraftKings:"👑",FanDuel:"⚡",Bankroll:"💰",Multiple:"🎯"})[h]||"👥",m=()=>{var h;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 uppercase tracking-wide mb-3",children:"Basic Information"}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Group ID"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:a.id})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Name"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:a.name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Invite Code"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 font-mono",children:a.inviteCode||"None"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Privacy"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 capitalize",children:a.privacy})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Created By"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:a.createdBy})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 uppercase tracking-wide mb-3",children:"Platform Information"}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Type"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:a.type})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Platform"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:x(a.platform)}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:a.platform})]})]}),((h=a.platformDetails)==null?void 0:h.leagueId)&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"League ID"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 font-mono",children:a.platformDetails.leagueId})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Status"}),e.jsx("span",{className:`text-sm font-medium px-2 py-1 rounded ${a.status==="active"?"bg-green-100 text-green-800":a.status==="archived"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:a.status})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 uppercase tracking-wide mb-3",children:"Timeline"}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Created"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:d(a.createdAt)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Last Active"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:d(a.lastActive)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Group Age"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:a.groupAge})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 uppercase tracking-wide mb-3",children:"Group Settings"}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Auto Split"}),a.settings.autoSplit?e.jsx("span",{className:"text-green-600",children:"✓ Enabled"}):e.jsx("span",{className:"text-gray-400",children:"✗ Disabled"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Weekly Dues"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:i(a.settings.weeklyDues)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Split Percentage"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[a.settings.defaultSplitPercentage,"%"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Guest Bets"}),a.settings.allowGuestBets?e.jsx("span",{className:"text-green-600",children:"✓ Allowed"}):e.jsx("span",{className:"text-gray-400",children:"✗ Not Allowed"})]})]})]})]})},o=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 uppercase tracking-wide mb-3",children:"Member Summary"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 text-center",children:[e.jsx(z,{className:"w-6 h-6 text-blue-600 mx-auto mb-2"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:a.memberCount}),e.jsx("p",{className:"text-sm text-gray-600",children:"Total Members"})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-4 text-center",children:[e.jsx(Fe,{className:"w-6 h-6 text-green-600 mx-auto mb-2"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:a.activity.activeMembers}),e.jsx("p",{className:"text-sm text-gray-600",children:"Active Members"})]}),e.jsxs("div",{className:"bg-purple-50 rounded-lg p-4 text-center",children:[e.jsx(ae,{className:"w-6 h-6 text-purple-600 mx-auto mb-2"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-600",children:[Math.round(a.activity.activeMembers/a.memberCount*100),"%"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Activity Rate"})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 uppercase tracking-wide mb-3",children:"Top Members"}),e.jsxs("div",{className:"bg-gray-50 rounded-lg overflow-hidden",children:[a.memberDetails&&a.memberDetails.length>0?e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Member"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Role"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Balance"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Joined"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:a.memberDetails.map(h=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:h.username}),e.jsx("p",{className:"text-xs text-gray-500",children:h.email})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`text-xs px-2 py-1 rounded ${h.role==="admin"?"bg-purple-100 text-purple-800":"bg-gray-100 text-gray-800"}`,children:h.role})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:i(h.balance)}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:h.joinedAt?d(h.joinedAt):"N/A"})]},h.id))})]}):e.jsx("p",{className:"text-center py-8 text-gray-500",children:"No member details available"}),a.memberCount>10&&e.jsx("div",{className:"px-4 py-3 bg-gray-100 text-center",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["Showing top 10 of ",a.memberCount," members"]})})]})]})]}),g=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 uppercase tracking-wide mb-3",children:"Activity Overview"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx(le,{className:"w-5 h-5 text-gray-600 mb-2"}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:a.activity.totalTransactions}),e.jsx("p",{className:"text-sm text-gray-600",children:"Total Transactions"})]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsx(ne,{className:"w-5 h-5 text-blue-600 mb-2"}),e.jsx("p",{className:"text-xl font-bold text-blue-600",children:a.activity.last24Hours}),e.jsx("p",{className:"text-sm text-gray-600",children:"Last 24 Hours"})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[e.jsx(ae,{className:"w-5 h-5 text-green-600 mb-2"}),e.jsx("p",{className:"text-xl font-bold text-green-600",children:a.activity.lastWeek}),e.jsx("p",{className:"text-sm text-gray-600",children:"Last Week"})]}),e.jsxs("div",{className:"bg-purple-50 rounded-lg p-4",children:[e.jsx(Y,{className:"w-5 h-5 text-purple-600 mb-2"}),e.jsx("p",{className:"text-xl font-bold text-purple-600",children:i(a.activity.totalVolume)}),e.jsx("p",{className:"text-sm text-gray-600",children:"Total Volume"})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 uppercase tracking-wide mb-3",children:"Transaction Breakdown"}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsx("div",{className:"space-y-3",children:Object.entries(a.activity.transactionTypes).map(([h,u])=>{const N=Object.values(a.activity.transactionTypes).reduce((M,E)=>M+E,0),T=N>0?u/N*100:0;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsx("span",{className:"text-sm capitalize text-gray-600",children:h}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[u," (",T.toFixed(1),"%)"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"h-2 rounded-full bg-purple-600",style:{width:`${T}%`}})})]},h)})})})]}),a.activity.lastTransaction&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 uppercase tracking-wide mb-3",children:"Last Transaction"}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:a.activity.lastTransaction.type}),e.jsx("span",{className:"text-sm font-medium text-blue-600",children:i(a.activity.lastTransaction.amount)})]}),e.jsx("p",{className:"text-xs text-gray-600",children:a.activity.lastTransaction.description}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:d(a.activity.lastTransaction.createdAt)})]})]})]}),b=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 uppercase tracking-wide mb-3",children:"Financial Summary"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[e.jsx(Y,{className:"w-5 h-5 text-green-600 mb-2"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:i(a.financials.totalPoolBalance)}),e.jsx("p",{className:"text-sm text-gray-600",children:"Pool Balance"})]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsx(z,{className:"w-5 h-5 text-blue-600 mb-2"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:i(a.financials.totalMemberBalances)}),e.jsx("p",{className:"text-sm text-gray-600",children:"Member Balances"})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 uppercase tracking-wide mb-3",children:"Pending Items"}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Pending Dues"}),e.jsx("span",{className:"text-sm font-medium text-orange-600",children:i(a.financials.pendingDues)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Upcoming Payouts"}),e.jsx("span",{className:"text-sm font-medium text-green-600",children:i(a.financials.upcomingPayouts)})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 uppercase tracking-wide mb-3",children:"Financial Health"}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsx("div",{className:"flex items-center gap-3",children:a.financials.totalPoolBalance>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(J,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Healthy"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Group has sufficient pool balance"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-12 h-12 bg-yellow-100 rounded-full flex items-center justify-center",children:e.jsx(Be,{className:"w-6 h-6 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Low Balance"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Group pool balance is empty"})]})]})})})]})]}),c=[{id:"overview",label:"Overview",icon:Ie},{id:"members",label:"Members",icon:z},{id:"activity",label:"Activity",icon:le},{id:"financials",label:"Financials",icon:Y}];return e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center text-2xl",children:x(a.platform)}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:a.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[a.type," • ",a.platform]})]})]}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(je,{className:"w-5 h-5 text-gray-500"})})]}),e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"flex",children:c.map(h=>{const u=h.icon;return e.jsxs("button",{onClick:()=>n(h.id),className:`flex items-center gap-2 px-6 py-3 text-sm font-medium border-b-2 transition-colors ${r===h.id?"text-purple-600 border-purple-600":"text-gray-500 border-transparent hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(u,{className:"w-4 h-4"}),h.label]},h.id)})})}),e.jsxs("div",{className:"p-6 overflow-y-auto",style:{maxHeight:"calc(90vh - 200px)"},children:[r==="overview"&&m(),r==="members"&&o(),r==="activity"&&g(),r==="financials"&&b()]}),e.jsxs("div",{className:"px-6 py-4 border-t border-gray-200 flex justify-between",children:[e.jsxs("div",{className:"flex gap-2",children:[a.status==="archived"?e.jsxs("button",{onClick:()=>t(a.id,"unarchive"),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 flex items-center gap-2",children:[e.jsx(he,{className:"w-4 h-4"}),"Unarchive Group"]}):e.jsxs("button",{onClick:()=>t(a.id,"archive"),className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 flex items-center gap-2",children:[e.jsx(he,{className:"w-4 h-4"}),"Archive Group"]}),e.jsxs("button",{className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 flex items-center gap-2",children:[e.jsx(Re,{className:"w-4 h-4"}),"View Analytics"]})]}),e.jsx("button",{onClick:s,className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700",children:"Close"})]})]})})},Qe=()=>{const[a,s]=j.useState([]),[t,r]=j.useState(!0),[n,i]=j.useState(null),[d,x]=j.useState(""),[m,o]=j.useState("all"),[g,b]=j.useState("all"),[c,h]=j.useState(null),[u,N]=j.useState(!1),[T,M]=j.useState(null),[E,f]=j.useState(null),[w,k]=j.useState(!1);j.useEffect(()=>{l(),y()},[]);const l=async(p=!1)=>{try{r(!0),i(null);const D=await _.getGroupsPaginated(50,p?E:null);s(p?H=>[...H,...D.groups]:D.groups),f(D.lastDoc),k(D.hasMore)}catch(D){console.error("Error loading groups:",D),i("Failed to load groups")}finally{r(!1)}},y=async()=>{try{const p=await _.getGroupStatistics();M(p)}catch(p){console.error("Error loading statistics:",p)}},S=async()=>{if(!d.trim()){l();return}try{r(!0);const p=await _.searchGroups(d);s(p),k(!1)}catch(p){console.error("Error searching groups:",p),i("Search failed")}finally{r(!1)}},A=async(p,D)=>{try{switch(D){case"archive":await _.archiveGroup(p);break;case"unarchive":await _.unarchiveGroup(p);break}l()}catch(H){console.error(`Error performing ${D}:`,H),alert(`Failed to ${D} group`)}},P=p=>{const D={Sleeper:{bg:"bg-purple-100",text:"text-purple-800",icon:"🏈"},ESPN:{bg:"bg-red-100",text:"text-red-800",icon:"🏀"},Yahoo:{bg:"bg-purple-100",text:"text-purple-800",icon:"⚾"},DraftKings:{bg:"bg-orange-100",text:"text-orange-800",icon:"👑"},FanDuel:{bg:"bg-blue-100",text:"text-blue-800",icon:"⚡"},Bankroll:{bg:"bg-gray-100",text:"text-gray-800",icon:"💰"},Multiple:{bg:"bg-green-100",text:"text-green-800",icon:"🎯"}},H=D[p]||D.Bankroll;return e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${H.bg} ${H.text}`,children:[e.jsx("span",{className:"mr-1",children:H.icon}),p]})},B=p=>{const D={active:"bg-green-100 text-green-800",inactive:"bg-gray-100 text-gray-800",dormant:"bg-yellow-100 text-yellow-800",archived:"bg-red-100 text-red-800"};return e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded ${D[p]||D.inactive}`,children:p})},F=p=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(p||0),R=p=>p?(p.toDate?p.toDate():new Date(p)).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"N/A",$=a.filter(p=>!(m!=="all"&&p.status!==m||g!=="all"&&p.platform!==g));return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Group Management"}),e.jsx("button",{onClick:()=>l(),className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg",children:e.jsx(oe,{className:"w-5 h-5"})})]}),T&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Groups"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:T.total})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Active"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:T.active})]}),e.jsxs("div",{className:"bg-purple-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Sleeper"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:T.byPlatform.sleeper})]}),e.jsxs("div",{className:"bg-red-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"ESPN"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:T.byPlatform.espn})]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Fantasy"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:T.byType.fantasy})]}),e.jsxs("div",{className:"bg-yellow-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Avg Members"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:T.averageMembers})]}),e.jsxs("div",{className:"bg-indigo-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"New Today"}),e.jsx("p",{className:"text-2xl font-bold text-indigo-600",children:T.newToday})]})]}),T&&e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-3",children:"Platform Distribution"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:Object.entries(T.byPlatform).map(([p,D])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm capitalize text-gray-600",children:p}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:D})]},p))})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(de,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"Search by name or invite code...",value:d,onChange:p=>x(p.target.value),onKeyPress:p=>p.key==="Enter"&&S(),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),e.jsxs("select",{value:m,onChange:p=>o(p.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"}),e.jsx("option",{value:"dormant",children:"Dormant"}),e.jsx("option",{value:"archived",children:"Archived"})]}),e.jsxs("select",{value:g,onChange:p=>b(p.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500",children:[e.jsx("option",{value:"all",children:"All Platforms"}),e.jsx("option",{value:"Sleeper",children:"Sleeper"}),e.jsx("option",{value:"ESPN",children:"ESPN"}),e.jsx("option",{value:"Yahoo",children:"Yahoo"}),e.jsx("option",{value:"DraftKings",children:"DraftKings"}),e.jsx("option",{value:"FanDuel",children:"FanDuel"}),e.jsx("option",{value:"Bankroll",children:"Bankroll"})]}),e.jsxs("button",{className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 flex items-center gap-2",children:[e.jsx(Ne,{className:"w-4 h-4"}),"Export"]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Group Info"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type/Platform"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Members"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Activity"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Financials"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Created"}),e.jsx("th",{className:"relative px-6 py-3",children:e.jsx("span",{className:"sr-only",children:"Actions"})})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t&&a.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"8",className:"px-6 py-4 text-center text-gray-500",children:"Loading groups..."})}):$.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"8",className:"px-6 py-4 text-center text-gray-500",children:"No groups found"})}):$.map(p=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 bg-purple-100 rounded-full flex items-center justify-center",children:e.jsx(z,{className:"h-5 w-5 text-purple-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:p.name}),e.jsx("div",{className:"text-sm text-gray-500",children:p.inviteCode||"No code"})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[P(p.platform),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:p.type})]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsxs("div",{className:"text-sm text-gray-900",children:[p.memberCount," members"]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[p.activity.activeMembers," active"]})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsxs("div",{className:"text-sm text-gray-900",children:[p.activity.totalTransactions," txns"]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[p.activity.last24Hours," today"]})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:F(p.financials.totalPoolBalance)}),e.jsx("div",{className:"text-sm text-gray-500",children:"Pool balance"})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:B(p.status)}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm text-gray-900",children:R(p.createdAt)}),e.jsx("div",{className:"text-sm text-gray-500",children:p.groupAge})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[e.jsx("button",{onClick:()=>{h(p),N(!0)},className:"text-purple-600 hover:text-purple-900 mr-3",children:"View"}),e.jsx("button",{className:"text-gray-400 hover:text-gray-600",children:e.jsx(Oe,{className:"w-4 h-4"})})]})]},p.id))})]})}),w&&e.jsxs("div",{className:"px-6 py-4 border-t border-gray-200 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>l(),disabled:t,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50",children:e.jsx(Ce,{className:"w-4 h-4"})}),e.jsxs("span",{className:"text-sm text-gray-700",children:["Showing ",a.length," groups"]}),e.jsx("button",{onClick:()=>l(!0),disabled:!w||t,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50",children:e.jsx(Me,{className:"w-4 h-4"})})]}),u&&c&&e.jsx(Je,{group:c,onClose:()=>{N(!1),h(null)},onAction:A})]})},Xe=()=>{const{isDark:a}=Ee(),[s,t]=j.useState([]),[r,n]=j.useState(!0),[i,d]=j.useState({totalBalance:0,totalDeposits:0,totalWithdrawals:0,pendingWithdrawals:0,activeUsers:0,monthlyVolume:0}),[x,m]=j.useState("all"),[o,g]=j.useState(""),[b,c]=j.useState("week");j.useEffect(()=>{h()},[x,b]);const h=async()=>{try{n(!0);const f=C(v,"transactions");let w=U(f,I("createdAt","desc"),O(100));x!=="all"&&(w=U(f,W("type","==",x),I("createdAt","desc"),O(100)));const l=(await G(w)).docs.map(y=>({id:y.id,...y.data()}));t(l),u(l)}catch(f){console.error("Error fetching financial data:",f)}finally{n(!1)}},u=f=>{const w={totalBalance:0,totalDeposits:0,totalWithdrawals:0,pendingWithdrawals:0,activeUsers:new Set,monthlyVolume:0},k=new Date,l=new Date(k.getFullYear(),k.getMonth()-1,k.getDate());f.forEach(y=>{var A;y.type==="deposit"?(w.totalDeposits+=y.amount,w.totalBalance+=y.amount):y.type==="withdrawal"&&(w.totalWithdrawals+=y.amount,w.totalBalance-=y.amount,y.status==="pending"&&(w.pendingWithdrawals+=y.amount)),w.activeUsers.add(y.userId),((A=y.createdAt)!=null&&A.toDate?y.createdAt.toDate():new Date(y.createdAt))>l&&(w.monthlyVolume+=y.amount)}),w.activeUsers=w.activeUsers.size,d(w)},N=f=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(f),T=f=>f?(f.toDate?f.toDate():new Date(f)).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A",M=f=>{switch(f){case"completed":return"text-green-600 bg-green-100";case"pending":return"text-yellow-600 bg-yellow-100";case"failed":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}},E=({title:f,value:w,change:k,icon:l,color:y})=>e.jsxs("div",{className:`p-6 rounded-lg ${a?"bg-gray-800":"bg-white"} shadow`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:`p-3 rounded-lg ${y}`,children:e.jsx(l,{className:"h-6 w-6 text-white"})}),k&&e.jsxs("div",{className:`flex items-center ${k>0?"text-green-500":"text-red-500"}`,children:[k>0?e.jsx(We,{className:"h-4 w-4"}):e.jsx(He,{className:"h-4 w-4"}),e.jsxs("span",{className:"text-sm font-medium",children:[Math.abs(k),"%"]})]})]}),e.jsx("h3",{className:`text-sm font-medium ${a?"text-gray-400":"text-gray-600"}`,children:f}),e.jsx("p",{className:`text-2xl font-bold mt-1 ${a?"text-white":"text-gray-900"}`,children:w})]});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(E,{title:"Total Balance",value:N(i.totalBalance),change:12,icon:Y,color:"bg-blue-500"}),e.jsx(E,{title:"Total Deposits",value:N(i.totalDeposits),change:8,icon:ae,color:"bg-green-500"}),e.jsx(E,{title:"Total Withdrawals",value:N(i.totalWithdrawals),change:-3,icon:ze,color:"bg-orange-500"}),e.jsx(E,{title:"Pending Withdrawals",value:N(i.pendingWithdrawals),icon:xe,color:"bg-purple-500"})]}),e.jsx("div",{className:`p-6 rounded-lg ${a?"bg-gray-800":"bg-white"} shadow`,children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("select",{value:x,onChange:f=>m(f.target.value),className:`px-4 py-2 rounded-lg border ${a?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-900"}`,children:[e.jsx("option",{value:"all",children:"All Transactions"}),e.jsx("option",{value:"deposit",children:"Deposits"}),e.jsx("option",{value:"withdrawal",children:"Withdrawals"}),e.jsx("option",{value:"bonus",children:"Bonuses"}),e.jsx("option",{value:"transfer",children:"Transfers"})]}),e.jsxs("select",{value:b,onChange:f=>c(f.target.value),className:`px-4 py-2 rounded-lg border ${a?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-900"}`,children:[e.jsx("option",{value:"today",children:"Today"}),e.jsx("option",{value:"week",children:"This Week"}),e.jsx("option",{value:"month",children:"This Month"}),e.jsx("option",{value:"year",children:"This Year"})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(de,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search transactions...",value:o,onChange:f=>g(f.target.value),className:`pl-10 pr-4 py-2 rounded-lg border ${a?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-900"}`})]}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:[e.jsx(Ne,{className:"h-4 w-4"}),"Export"]})]})]})}),e.jsxs("div",{className:`rounded-lg ${a?"bg-gray-800":"bg-white"} shadow overflow-hidden`,children:[e.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:e.jsx("h2",{className:`text-lg font-semibold ${a?"text-white":"text-gray-900"}`,children:"Recent Transactions"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:`${a?"bg-gray-700":"bg-gray-50"}`,children:e.jsxs("tr",{children:[e.jsx("th",{className:`px-6 py-3 text-left text-xs font-medium uppercase tracking-wider ${a?"text-gray-300":"text-gray-500"}`,children:"User"}),e.jsx("th",{className:`px-6 py-3 text-left text-xs font-medium uppercase tracking-wider ${a?"text-gray-300":"text-gray-500"}`,children:"Type"}),e.jsx("th",{className:`px-6 py-3 text-left text-xs font-medium uppercase tracking-wider ${a?"text-gray-300":"text-gray-500"}`,children:"Amount"}),e.jsx("th",{className:`px-6 py-3 text-left text-xs font-medium uppercase tracking-wider ${a?"text-gray-300":"text-gray-500"}`,children:"Status"}),e.jsx("th",{className:`px-6 py-3 text-left text-xs font-medium uppercase tracking-wider ${a?"text-gray-300":"text-gray-500"}`,children:"Date"}),e.jsx("th",{className:`px-6 py-3 text-left text-xs font-medium uppercase tracking-wider ${a?"text-gray-300":"text-gray-500"}`,children:"Actions"})]})}),e.jsx("tbody",{className:`divide-y ${a?"divide-gray-700":"divide-gray-200"}`,children:r?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"px-6 py-4 text-center",children:e.jsx("div",{className:"animate-pulse",children:"Loading transactions..."})})}):s.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"px-6 py-4 text-center text-gray-500",children:"No transactions found"})}):s.filter(f=>{var w,k;return o===""||((w=f.username)==null?void 0:w.toLowerCase().includes(o.toLowerCase()))||((k=f.email)==null?void 0:k.toLowerCase().includes(o.toLowerCase()))}).map(f=>e.jsxs("tr",{className:`${a?"hover:bg-gray-700":"hover:bg-gray-50"}`,children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsx("div",{className:`text-sm font-medium ${a?"text-white":"text-gray-900"}`,children:f.username||"Unknown User"}),e.jsx("div",{className:`text-sm ${a?"text-gray-400":"text-gray-500"}`,children:f.email})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[f.type==="deposit"&&e.jsx(qe,{className:"h-4 w-4 mr-2 text-green-500"}),f.type==="withdrawal"&&e.jsx(xe,{className:"h-4 w-4 mr-2 text-orange-500"}),e.jsx("span",{className:`text-sm ${a?"text-gray-300":"text-gray-900"}`,children:f.type.charAt(0).toUpperCase()+f.type.slice(1)})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("span",{className:`text-sm font-medium ${f.type==="deposit"?"text-green-600":"text-orange-600"}`,children:[f.type==="deposit"?"+":"-",N(f.amount)]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${M(f.status)}`,children:f.status})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:T(f.createdAt)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsx("button",{className:"text-purple-600 hover:text-purple-900",children:"View Details"})})]},f.id))})]})})]})]})},Ze=()=>{const[a,s]=j.useState([]),[t,r]=j.useState(!0),[n,i]=j.useState(""),[d,x]=j.useState("all"),[m,o]=j.useState({totalGroups:0,activeGroups:0,totalFundsPooled:0,pendingInvites:0});j.useEffect(()=>{g()},[]);const g=async()=>{var u,N;try{r(!0);const T=await G(C(v,"groups")),M=[];let E=0,f=0,w=0;for(const k of T.docs){const l={id:k.id,...k.data()},y=[];let S=[];if(l.members&&(Array.isArray(l.members)?S=l.members:typeof l.members=="object"&&(S=Object.keys(l.members))),S.length>0)for(const R of S)try{const $=String(R);if(!$||$==="undefined"||$==="null"){console.warn("Invalid member ID:",R);continue}const p=await V(L(v,"users",$));if(p.exists()){const D=p.data();y.push({id:$,username:D.username||"Unknown",email:D.email})}}catch($){console.error("Error fetching member:",$,"Member ID:",R)}const A=l.totalBalance||0;E+=A;const P=l.pendingInvites||[];f+=P.length;const B=l.status==="active"||!l.status&&S.length>0;B&&w++;let F=null;try{const R=U(C(v,"transactions"),W("groupId","==",k.id),I("createdAt","desc")),$=await G(R);$.empty||(F=((u=$.docs[0].data().createdAt)==null?void 0:u.toDate())||null)}catch(R){(N=R.message)!=null&&N.includes("index")||console.warn("Could not fetch group transactions:",R)}M.push({...l,memberDetails:y,memberCount:S.length,fundsPooled:A,pendingInvites:P,lastActivity:F,isActive:B})}s(M),o({totalGroups:M.length,activeGroups:w,totalFundsPooled:E,pendingInvites:f})}catch(T){console.error("Error loading leagues/groups:",T)}finally{r(!1)}},b=a.filter(u=>{var M,E;const N=n===""||((M=u.name)==null?void 0:M.toLowerCase().includes(n.toLowerCase()))||((E=u.description)==null?void 0:E.toLowerCase().includes(n.toLowerCase())),T=d==="all"||d==="active"&&u.isActive||d==="inactive"&&!u.isActive||d==="pending"&&u.pendingInvites.length>0;return N&&T}),c=u=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(u||0),h=u=>u?new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(u):"Never";return t?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Groups"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:m.totalGroups})]}),e.jsx(J,{className:"h-8 w-8 text-blue-500"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Active Groups"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:m.activeGroups})]}),e.jsx(le,{className:"h-8 w-8 text-green-500"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Funds Pooled"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:c(m.totalFundsPooled)})]}),e.jsx(Y,{className:"h-8 w-8 text-purple-500"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Pending Invites"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:m.pendingInvites})]}),e.jsx(se,{className:"h-8 w-8 text-orange-500"})]})})]}),e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(de,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5"}),e.jsx("input",{type:"text",placeholder:"Search by group name or description...",value:n,onChange:u=>i(u.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("select",{value:d,onChange:u=>x(u.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All Groups"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"}),e.jsx("option",{value:"pending",children:"With Pending Invites"})]}),e.jsxs("button",{onClick:g,className:"flex items-center gap-2 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:[e.jsx(oe,{className:"h-4 w-4"}),"Refresh"]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Group Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Members"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Funds Pooled"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Pending Invites"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Last Activity"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Created"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:b.map(u=>{var N,T;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 bg-blue-100 rounded-full flex items-center justify-center",children:u.isFantasyLeague?e.jsx(be,{className:"h-5 w-5 text-blue-600"}):e.jsx(J,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:u.name||"Unnamed Group"}),e.jsx("div",{className:"text-sm text-gray-500",children:u.description||"No description"})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${u.isFantasyLeague?"bg-purple-100 text-purple-800":"bg-blue-100 text-blue-800"}`,children:u.isFantasyLeague?"Fantasy League":"Social Group"})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsxs("div",{className:"text-sm text-gray-900",children:[u.memberCount," members"]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[u.memberDetails.slice(0,2).map(M=>M.username).join(", "),u.memberCount>2&&` +${u.memberCount-2} more`]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:c(u.fundsPooled)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:u.isActive?e.jsxs("span",{className:"inline-flex items-center gap-1 text-green-600",children:[e.jsx(re,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:"Active"})]}):e.jsxs("span",{className:"inline-flex items-center gap-1 text-gray-600",children:[e.jsx(ie,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:"Inactive"})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:u.pendingInvites.length>0?e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-orange-100 text-orange-800",children:[u.pendingInvites.length," pending"]}):e.jsx("span",{className:"text-sm text-gray-500",children:"None"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:h(u.lastActivity)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:h((T=(N=u.createdAt)==null?void 0:N.toDate)==null?void 0:T.call(N))})]},u.id)})})]}),b.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(J,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No groups found matching your criteria"})]})]})})]})},vt=()=>{const a=Pe(),[s,t]=j.useState([]),[r,n]=j.useState(!0),[i,d]=j.useState(""),[x,m]=j.useState(null),[o,g]=j.useState("player-management"),[b,c]=j.useState(null),[h,u]=j.useState(!1),[N,T]=j.useState(null),[M,E]=j.useState(!0),[f,w]=j.useState({totalUsers:0,totalReferrals:0,totalLeagues:0,emailSubscribed:0});if(j.useEffect(()=>{(async()=>{try{n(!0);const y=await ce.getAllUsers();t(y);const S=await ce.getAdminStats();w(S)}catch(y){m("Failed to fetch users"),console.error("Error fetching users:",y)}finally{n(!1)}})()},[]),s.filter(l=>{var S,A,P,B;const y=i.toLowerCase();return((S=l.email)==null?void 0:S.toLowerCase().includes(y))||((A=l.username)==null?void 0:A.toLowerCase().includes(y))||((P=l.firstName)==null?void 0:P.toLowerCase().includes(y))||((B=l.lastName)==null?void 0:B.toLowerCase().includes(y))}),x)return e.jsx("div",{className:"p-4 bg-red-500/10 text-red-500 rounded-lg border border-red-500/20",children:x});const k=({icon:l,label:y,isActive:S,onClick:A})=>e.jsxs("button",{onClick:A,className:`w-full flex items-center gap-3 px-4 py-3 text-left transition-colors rounded-lg ${S?"bg-blue-50 text-blue-600 font-medium":"text-gray-700 hover:bg-gray-100 hover:text-gray-900"}`,children:[e.jsx(l,{className:"h-5 w-5"}),e.jsx("span",{children:y})]});return e.jsxs("div",{className:"flex h-screen bg-gray-100",children:[e.jsxs("div",{className:"w-64 border-r border-gray-300 bg-white flex flex-col",children:[e.jsxs("div",{className:"p-4 flex-1",children:[e.jsx("h2",{className:"text-xl font-bold mb-6 text-gray-800",children:"Admin Dashboard"}),e.jsxs("nav",{className:"space-y-1",children:[e.jsx(k,{icon:z,label:"Player Management",isActive:o==="player-management",onClick:()=>g("player-management")}),e.jsx(k,{icon:Y,label:"Funds Management",isActive:o==="funds-management",onClick:()=>g("funds-management")}),e.jsx(k,{icon:be,label:"Big Win Alerts",isActive:o==="winners-management",onClick:()=>g("winners-management")}),e.jsx(k,{icon:fe,label:"Notification Hub",isActive:o==="notification-hub",onClick:()=>g("notification-hub")}),e.jsx(k,{icon:J,label:"Leagues/Groups",isActive:o==="leagues-groups",onClick:()=>g("leagues-groups")})]})]}),e.jsx("div",{className:"p-4 border-t border-gray-200",children:e.jsxs("button",{onClick:()=>{localStorage.removeItem("adminAuthenticated"),a("/admin-login")},className:"w-full flex items-center gap-3 px-4 py-3 text-left transition-colors hover:bg-red-50 text-red-600 rounded-lg",children:[e.jsx(Ve,{className:"h-5 w-5"}),e.jsx("span",{children:"Logout"})]})})]}),e.jsxs("div",{className:"flex-1 overflow-auto p-8 bg-gray-50",children:[o==="player-management"?e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold mb-6 text-gray-900",children:"Player Management"}),e.jsx($e,{}),e.jsx("div",{className:"mt-8",children:e.jsx(Qe,{})})]}):o==="funds-management"?e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold mb-6 text-gray-900",children:"Funds Management"}),e.jsx(Xe,{})]}):o==="winners-management"?e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold mb-6 text-gray-900",children:"Big Win Alerts Management"}),e.jsx(Le,{})]}):o==="notification-hub"?e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold mb-6 text-gray-900",children:"Notification Hub"}),e.jsx(_e,{})]}):o==="leagues-groups"?e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold mb-6 text-gray-900",children:"Leagues & Groups Management"}),e.jsx(Ze,{})]}):null,h&&b&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 max-w-md w-full",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-xl font-bold",children:"Delete User"}),e.jsx("button",{onClick:()=>u(!1),className:"p-1 hover:bg-gray-700 rounded-full",children:e.jsx(je,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-gray-300 mb-2",children:"Are you sure you want to delete this user?"}),e.jsxs("div",{className:"bg-gray-700/50 p-3 rounded-md",children:[e.jsx("p",{className:"font-medium text-black",children:b.firstName&&b.lastName?`${b.firstName} ${b.lastName}`:"No name provided"}),e.jsxs("p",{className:"text-sm text-gray-400",children:["@",b.username]}),e.jsx("p",{className:"text-sm text-gray-400",children:b.email})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3",children:[e.jsx("button",{onClick:()=>u(!1),className:"px-4 py-2 text-gray-400 hover:bg-gray-700 rounded-md",children:"Cancel"}),e.jsx("button",{onClick:()=>{alert("Delete user feature coming soon"),u(!1)},className:"px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600",children:"Delete User"})]})]})})]})]})};export{vt as default};
