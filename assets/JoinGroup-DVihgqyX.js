import{e as E,f,q as C,g as D,i as F,Y as k,u as J,y as B,J as S,r as i,P as L,j as e,U as m,Q,K as u}from"./main-Bt21LLck.js";import{B as p}from"./button-BARmkLdK.js";import{L as R}from"./lock-CudpYHpY.js";class g extends Error{constructor(r,o,n,c){super(r),this.code=o,this.operation=n,this.path=c,this.name="FirestoreError"}}function b(s,r,o){throw console.error(`Firestore ${r} error:`,s),s instanceof Error?new g(s.message,s.code,r,o):new g("An unknown error occurred","unknown",r,o)}function j(){return{toFirestore(s){return s},fromFirestore(s){return s.data()}}}function q(s,...r){return F(f,s,...r).withConverter(j())}function U(s,...r){return E(f,s,...r).withConverter(j())}async function A(s){try{const r=await k(s);return r.exists()?r.data():null}catch(r){b(r,"get",s.path)}}async function I(s){try{return(await D(s)).docs.map(o=>o.data())}catch(r){b(r,"query",s.toString())}}function M(s,...r){return C(s,...r)}const H=()=>{const s=J(),{currentUser:r}=B(),{joinGroup:o}=S(),[n,c]=i.useState(!0),[d,y]=i.useState([]),[h,w]=i.useState(null);i.useEffect(()=>{(async()=>{try{const a=U("groups"),l=M(a,L("visibility","==","public")),v=await I(l),G=await Promise.all(v.map(async x=>{const P=q("groups",x.id);return await A(P)||x}));y(G)}catch(a){console.error("Error fetching public groups:",a),w("Failed to load public groups")}finally{c(!1)}})()},[]);const N=async t=>{if(!r){u.error("Please sign in to join a group"),s("/login");return}c(!0);try{await o(t),u.success("Successfully joined group!"),s("/groups")}catch(a){console.error("Error joining group:",a);const l=a.message||"Failed to join group. Please try again.";u.error(l)}finally{c(!1)}};return e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-8",children:[e.jsx(m,{className:"w-8 h-8 text-blue-500"}),e.jsx("h1",{className:"text-3xl font-bold text-white",children:"Join a Group"})]}),e.jsxs("div",{className:"mb-12",children:[e.jsxs("h2",{className:"text-xl font-semibold text-white mb-4 flex items-center",children:[e.jsx(m,{className:"w-5 h-5 mr-2"}),"Public Groups"]}),n?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}):h?e.jsx("div",{className:"bg-red-500/10 border border-red-500/20 rounded-lg p-4",children:e.jsx("p",{className:"text-red-500 text-center",children:h})}):d.length===0?e.jsx("div",{className:"bg-gray-800/50 rounded-lg p-6",children:e.jsx("p",{className:"text-gray-400 text-center",children:"No public groups available at the moment."})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:d.map(t=>{var a;return e.jsx(Q,{className:"bg-gray-800/50 border-purple-500/20 hover:border-purple-500/40 transition-all duration-200",children:e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"text-2xl",children:t.emoji}),e.jsx("h3",{className:"text-xl font-semibold text-white",children:t.name})]}),e.jsx("p",{className:"text-gray-400 text-sm",children:t.description}),e.jsxs("div",{className:"flex justify-between items-center text-sm text-gray-400",children:[e.jsxs("span",{children:["Members: ",t.memberIds.length]}),((a=t.wallet)==null?void 0:a.cashBalance)>0&&e.jsxs("span",{children:["Prize Pool: $",t.wallet.cashBalance]})]}),e.jsx(p,{onClick:()=>N(t.id),disabled:n,className:"w-full bg-blue-600 hover:bg-blue-700 text-white",children:n?"Joining...":"Join Group"})]})},t.id)})})]}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-semibold text-white mb-4 flex items-center",children:[e.jsx(R,{className:"w-5 h-5 mr-2"}),"Private Groups"]}),e.jsx("div",{className:"bg-gray-800/50 rounded-lg p-6",children:e.jsx("p",{className:"text-gray-400 text-center",children:"Private groups require an invitation from the group owner. Contact the group owner to get an invite code."})})]}),e.jsx("div",{className:"mt-8 flex justify-center",children:e.jsx(p,{onClick:()=>s("/groups"),className:"bg-gray-700 hover:bg-gray-600 text-white",children:"Back to Groups"})})]})};export{H as default};
