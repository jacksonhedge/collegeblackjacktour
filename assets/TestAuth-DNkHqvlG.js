import{y as T,r as a,a4 as C,a5 as u,a6 as S,$ as o,K as i,j as e,R as _,S as E,x as k}from"./main-Bt21LLck.js";import{B as n}from"./button-BARmkLdK.js";import{C as p}from"./circle-check-big-PbtGHC_l.js";import{C as j}from"./circle-x-Ch5ljYmC.js";import{K as A}from"./key-mOMej07n.js";const U=()=>{const{currentUser:r}=T(),[t,g]=a.useState(null),[x,N]=a.useState([]),[m,v]=a.useState(!1),[h,f]=a.useState(!1),[y,d]=a.useState(!0);a.useEffect(()=>{l()},[r]);const l=async()=>{if(!r){d(!1);return}d(!0);try{const s=C();g(s);const c=await u.isDeviceTrusted(r.id,s.deviceId);f(c);const I=await S.hasPIN(r.id);v(I);const{data:P}=await o.from("trusted_devices").select("*").eq("user_id",r.id).eq("is_active",!0);N(P||[])}catch(s){console.error("Error loading auth info:",s),i.error("Failed to load authentication info")}finally{d(!1)}},b=async()=>{try{await u.trustDevice(r.id,t)&&(i.success("Device trusted successfully!"),await l())}catch(s){console.error("Error trusting device:",s),i.error("Failed to trust device")}},w=async s=>{try{const{error:c}=await o.from("trusted_devices").update({is_active:!1}).eq("device_id",s).eq("user_id",r.id);c||(i.success("Device removed"),await l())}catch(c){console.error("Error removing device:",c),i.error("Failed to remove device")}},D=async()=>{try{const{error:s}=await o.from("user_pins").delete().eq("user_id",r.id);s||(i.success("PIN cleared"),await l())}catch(s){console.error("Error clearing PIN:",s),i.error("Failed to clear PIN")}};return r?y?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(_,{className:"w-8 h-8 animate-spin text-purple-600"})})}):e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-8",children:"Authentication Testing"}),e.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-6 mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"Current User"}),e.jsxs("div",{className:"space-y-2 text-gray-300",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Email:"})," ",r.email]}),e.jsxs("p",{children:[e.jsx("strong",{children:"User ID:"})," ",r.id]}),e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx("strong",{children:"Has PIN:"}),m?e.jsxs("span",{className:"flex items-center gap-1 text-green-400",children:[e.jsx(p,{className:"w-4 h-4"})," Yes"]}):e.jsxs("span",{className:"flex items-center gap-1 text-red-400",children:[e.jsx(j,{className:"w-4 h-4"})," No"]})]})]}),e.jsx("div",{className:"mt-4 flex gap-3",children:m?e.jsx(n,{onClick:D,variant:"outline",className:"border-red-500 text-red-400 hover:bg-red-500/10",children:"Clear PIN"}):e.jsxs(n,{onClick:()=>window.location.href="/setup-pin",className:"bg-purple-600 hover:bg-purple-700",children:[e.jsx(A,{className:"w-4 h-4 mr-2"}),"Set Up PIN"]})})]}),e.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-6 mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"Current Device"}),t&&e.jsxs("div",{className:"space-y-2 text-gray-300",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Device ID:"})," ",e.jsx("code",{className:"text-xs",children:t.deviceId})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Device Name:"})," ",t.deviceName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Device Type:"})," ",t.deviceType]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Browser:"})," ",t.browserName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"OS:"})," ",t.osName]}),e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx("strong",{children:"Trusted:"}),h?e.jsxs("span",{className:"flex items-center gap-1 text-green-400",children:[e.jsx(p,{className:"w-4 h-4"})," Yes"]}):e.jsxs("span",{className:"flex items-center gap-1 text-red-400",children:[e.jsx(j,{className:"w-4 h-4"})," No"]})]})]}),!h&&e.jsxs(n,{onClick:b,className:"mt-4 bg-purple-600 hover:bg-purple-700",children:[e.jsx(E,{className:"w-4 h-4 mr-2"}),"Trust This Device"]})]}),e.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-6 mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"Trusted Devices"}),x.length===0?e.jsx("p",{className:"text-gray-400",children:"No trusted devices"}):e.jsx("div",{className:"space-y-3",children:x.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-900/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(k,{className:"w-5 h-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-medium",children:s.device_name}),e.jsxs("p",{className:"text-sm text-gray-400",children:["Added: ",new Date(s.created_at).toLocaleDateString()]}),s.device_id===(t==null?void 0:t.deviceId)&&e.jsx("p",{className:"text-xs text-purple-400 mt-1",children:"This device"})]})]}),e.jsx(n,{onClick:()=>w(s.device_id),variant:"ghost",size:"sm",className:"text-red-400 hover:text-red-300",children:"Remove"})]},s.id))})]}),e.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/20 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-300 mb-3",children:"Testing PIN Login"}),e.jsxs("ol",{className:"space-y-2 text-blue-200 list-decimal list-inside",children:[e.jsx("li",{children:"Set up a PIN if you haven't already"}),e.jsx("li",{children:"Trust this device"}),e.jsx("li",{children:"Log out and log back in"}),e.jsx("li",{children:"After entering your email, you should see the PIN login option"}),e.jsx("li",{children:"Enter your 4-digit PIN to log in quickly"})]}),e.jsx("div",{className:"mt-4 p-3 bg-blue-900/30 rounded",children:e.jsxs("p",{className:"text-sm text-blue-200",children:[e.jsx("strong",{children:"Note:"})," PIN login only appears on trusted devices where you've previously logged in with your password."]})})]})]}):e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"bg-yellow-500/10 border border-yellow-500/20 rounded-lg p-4",children:e.jsx("p",{className:"text-yellow-300",children:"Please log in to test authentication features"})})})};export{U as default};
