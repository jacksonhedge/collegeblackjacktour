import{L as J,y as L,d as q,u as P,r as o,e as w,f as N,q as I,P as d,g as C,j as e,Q as G,V as S,U as A,h as B}from"./main-Bt21LLck.js";import{g}from"./GroupService-BEuPNWui.js";import{L as $}from"./loader-circle-BfyHU3N4.js";import{C as M}from"./circle-x-Ch5ljYmC.js";import{C as O}from"./circle-check-big-PbtGHC_l.js";const K=()=>{var y,v;const{groupId:r,inviteCode:h}=J(),{currentUser:t}=L(),{isDark:a}=q(),i=P(),[k,f]=o.useState(!0),[s,E]=o.useState(null),[p,U]=o.useState(null),[m,x]=o.useState(""),[j,b]=o.useState(!1);o.useEffect(()=>{D()},[r,h,t]);const D=async()=>{try{const n=await g.getGroup(r);if(E(n),t&&await g.isUserInGroup(t.uid,r)){i("/groups");return}if(h){const l=w(N,"groupInvitations"),c=I(l,d("groupId","==",r),d("invitedUserId","==",t.uid),d("status","==","pending")),u=await C(c);u.empty||U(u.docs[0].data())}f(!1)}catch(n){console.error("Error loading invite details:",n),x("Invalid or expired invitation"),f(!1)}},R=async()=>{var n,l;b(!0),x("");try{if(await g.addMembers(r,[{uid:t.uid,displayName:((n=t.profile)==null?void 0:n.displayName)||t.email,photoURL:(l=t.profile)==null?void 0:l.profileImage}]),p){const c=w(N,"groupInvitations"),u=I(c,d("groupId","==",r),d("invitedUserId","==",t.uid));(await C(u)).forEach(async F=>{await B(F.ref,{status:"accepted",acceptedAt:new Date().toISOString()})})}i(`/groups/${r}`)}catch(c){console.error("Error joining group:",c),x("Failed to join group. Please try again."),b(!1)}};return k?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx($,{className:"w-8 h-8 animate-spin text-purple-600"})}):m&&!s?e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:e.jsx(G,{className:`max-w-md w-full ${a?"bg-gray-900":"bg-white"}`,children:e.jsxs(S,{className:"p-8 text-center",children:[e.jsx(M,{className:"w-16 h-16 mx-auto mb-4 text-red-500"}),e.jsx("h2",{className:`text-2xl font-bold mb-2 ${a?"text-white":"text-gray-900"}`,children:"Invalid Invitation"}),e.jsx("p",{className:`mb-6 ${a?"text-gray-400":"text-gray-600"}`,children:m}),e.jsx("button",{onClick:()=>i("/groups"),className:"px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700",children:"Go to Groups"})]})})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:e.jsx(G,{className:`max-w-md w-full ${a?"bg-gray-900":"bg-white"}`,children:e.jsxs(S,{className:"p-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-20 h-20 mx-auto mb-4 bg-purple-600 rounded-full flex items-center justify-center text-white text-3xl",children:(s==null?void 0:s.emoji)||e.jsx(A,{className:"w-10 h-10"})}),e.jsx("h1",{className:`text-3xl font-bold mb-2 ${a?"text-white":"text-gray-900"}`,children:s==null?void 0:s.name}),p&&e.jsxs("p",{className:`text-sm ${a?"text-gray-400":"text-gray-600"}`,children:["Invited by ",p.inviterName]})]}),e.jsxs("div",{className:`space-y-4 mb-8 ${a?"text-gray-300":"text-gray-700"}`,children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Members"}),e.jsx("span",{className:"font-medium",children:((y=s==null?void 0:s.memberIds)==null?void 0:y.length)||0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Group Balance"}),e.jsxs("span",{className:"font-medium",children:["$",((v=s==null?void 0:s.totalBalance)==null?void 0:v.toFixed(2))||"0.00"]})]}),(s==null?void 0:s.description)&&e.jsx("div",{className:"pt-4 border-t dark:border-gray-800",children:e.jsx("p",{className:"text-sm",children:s.description})})]}),m&&e.jsx("div",{className:"mb-4 p-3 bg-red-500/10 border border-red-500/20 rounded-lg text-red-500 text-sm",children:m}),e.jsxs("div",{className:"space-y-3",children:[t?e.jsx("button",{onClick:R,disabled:j,className:"w-full py-3 bg-purple-600 text-white rounded-lg font-medium hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:j?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"w-5 h-5 animate-spin"}),"Joining..."]}):e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"w-5 h-5"}),"Join Group"]})}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{sessionStorage.setItem("inviteRedirect",window.location.pathname),i("/login")},className:"w-full py-3 bg-purple-600 text-white rounded-lg font-medium hover:bg-purple-700",children:"Sign In to Join"}),e.jsx("button",{onClick:()=>{sessionStorage.setItem("inviteRedirect",window.location.pathname),i("/signup")},className:"w-full py-3 border border-purple-600 text-purple-600 rounded-lg font-medium hover:bg-purple-50",children:"Create Account"})]}),t&&e.jsx("button",{onClick:()=>i("/groups"),className:`w-full py-3 rounded-lg font-medium ${a?"bg-gray-800 text-gray-300 hover:bg-gray-700":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:"Cancel"})]})]})})})};export{K as default};
