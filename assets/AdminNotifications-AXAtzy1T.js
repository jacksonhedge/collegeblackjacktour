import{u as w,a as S,r as o,s as u,j as e,S as C,U as _,c as T,n as j,R as k}from"./main-Bt21LLck.js";import{L as A}from"./log-out-D1nti5kR.js";import{C as E}from"./circle-check-big-PbtGHC_l.js";import{C as y}from"./clock-Bf45bXE_.js";import{C as F}from"./circle-x-Ch5ljYmC.js";import{M as U}from"./mail-Dke56W7c.js";import{B as P}from"./bar-chart-3-CCCVoHVg.js";import{P as M}from"./plus-Dh4NC-lY.js";import{S as H}from"./square-pen-DghG-Vv-.js";import{T as D}from"./trash-2-CaBEjahI.js";import{f as b}from"./format-DptKEVlR.js";const Y=()=>{const t=w(),{isAuthenticated:i,logout:m}=S(),[l,n]=o.useState("send"),[d,r]=o.useState(!1),[c,s]=o.useState({totalSent:0,totalPending:0,totalFailed:0,totalUsers:0});o.useEffect(()=>{i||t("/admin")},[i,t]),o.useEffect(()=>{x()},[]);const x=async()=>{try{const{data:a}=await u.from("notifications").select("status",{count:"exact"}),{count:h}=await u.from("users").select("*",{count:"exact",head:!0}),g=(a==null?void 0:a.filter(f=>f.status==="sent").length)||0,N=(a==null?void 0:a.filter(f=>f.status==="pending").length)||0,v=(a==null?void 0:a.filter(f=>f.status==="failed").length)||0;s({totalSent:g,totalPending:N,totalFailed:v,totalUsers:h||0})}catch(a){console.error("Error fetching stats:",a)}},p=[{id:"send",label:"Send Notification",icon:e.jsx(T,{className:"w-4 h-4"})},{id:"templates",label:"Templates",icon:e.jsx(U,{className:"w-4 h-4"})},{id:"history",label:"History",icon:e.jsx(y,{className:"w-4 h-4"})},{id:"analytics",label:"Analytics",icon:e.jsx(P,{className:"w-4 h-4"})}];return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white shadow-sm border-b",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-16",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(C,{className:"w-6 h-6 text-purple-600"}),e.jsx("h1",{className:"text-xl font-semibold",children:"Notifications Admin"})]}),e.jsxs("button",{onClick:m,className:"flex items-center gap-2 px-4 py-2 text-sm text-gray-700 hover:text-gray-900 transition-colors",children:[e.jsx(A,{className:"w-4 h-4"}),"Logout"]})]})})}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Sent"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:c.totalSent})]}),e.jsx(E,{className:"w-8 h-8 text-green-600/20"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Pending"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:c.totalPending})]}),e.jsx(y,{className:"w-8 h-8 text-yellow-600/20"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Failed"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:c.totalFailed})]}),e.jsx(F,{className:"w-8 h-8 text-red-600/20"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Users"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:c.totalUsers})]}),e.jsx(_,{className:"w-8 h-8 text-purple-600/20"})]})})]})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"-mb-px flex space-x-8",children:p.map(a=>e.jsxs("button",{onClick:()=>n(a.id),className:`
                  py-2 px-1 border-b-2 font-medium text-sm flex items-center gap-2 transition-colors
                  ${l===a.id?"border-purple-500 text-purple-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}
                `,children:[a.icon,a.label]},a.id))})}),e.jsxs("div",{className:"py-6",children:[l==="send"&&e.jsx(B,{}),l==="templates"&&e.jsx(q,{}),l==="history"&&e.jsx($,{}),l==="analytics"&&e.jsx(L,{})]})]})]})},B=()=>{const[t,i]=o.useState({recipient:"all",specificUsers:"",template:"",customSubject:"",customBody:"",channels:["email","in_app"],scheduledFor:""}),[m,l]=o.useState([]),[n,d]=o.useState(!1);o.useEffect(()=>{r()},[]);const r=async()=>{try{const{data:s}=await u.from("notification_templates").select("*").eq("is_active",!0).order("category");l(s||[])}catch(s){console.error("Error fetching templates:",s)}},c=async()=>{d(!0);try{let s=[];if(t.recipient==="all"){const{data:a}=await u.from("users").select("id");s=a.map(h=>h.id)}else if(t.recipient==="specific"){const a=t.specificUsers.split(",").map(g=>g.trim()),{data:h}=await u.from("users").select("id, email").in("email",a);s=h.map(g=>g.id)}const x=m.find(a=>a.id===t.template);if(!x&&!t.customSubject){alert("Please select a template or provide custom content");return}const p=s.map(a=>x?j.sendNotification(a,x.name,{},{channels:t.channels,scheduledFor:t.scheduledFor||void 0}):u.from("notifications").insert(t.channels.map(h=>({user_id:a,channel:h,status:"pending",data:{subject:t.customSubject,body:t.customBody},scheduled_for:t.scheduledFor||new Date().toISOString()}))));await Promise.allSettled(p),t.scheduledFor||await j.triggerNotificationProcessing(),alert(`Successfully queued notifications for ${s.length} users`),i({recipient:"all",specificUsers:"",template:"",customSubject:"",customBody:"",channels:["email","in_app"],scheduledFor:""})}catch(s){console.error("Error sending notifications:",s),alert("Failed to send notifications")}finally{d(!1)}};return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-6",children:"Send Notification"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Recipients"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",value:"all",checked:t.recipient==="all",onChange:s=>i({...t,recipient:s.target.value}),className:"text-purple-600"}),e.jsx("span",{children:"All Users"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",value:"specific",checked:t.recipient==="specific",onChange:s=>i({...t,recipient:s.target.value}),className:"text-purple-600"}),e.jsx("span",{children:"Specific Users"})]})]}),t.recipient==="specific"&&e.jsx("input",{type:"text",value:t.specificUsers,onChange:s=>i({...t,specificUsers:s.target.value}),placeholder:"Enter user emails, comma separated",className:"mt-2 w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notification Content"}),e.jsxs("select",{value:t.template,onChange:s=>i({...t,template:s.target.value}),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500",children:[e.jsx("option",{value:"",children:"Custom Message"}),m.map(s=>e.jsxs("option",{value:s.id,children:[s.category," - ",s.name]},s.id))]})]}),!t.template&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Subject"}),e.jsx("input",{type:"text",value:t.customSubject,onChange:s=>i({...t,customSubject:s.target.value}),placeholder:"Notification subject",className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Message"}),e.jsx("textarea",{value:t.customBody,onChange:s=>i({...t,customBody:s.target.value}),placeholder:"Write your message here...",rows:6,className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Channels"}),e.jsx("div",{className:"space-y-2",children:["email","in_app","push"].map(s=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",value:s,checked:t.channels.includes(s),onChange:x=>{x.target.checked?i({...t,channels:[...t.channels,s]}):i({...t,channels:t.channels.filter(p=>p!==s)})},className:"text-purple-600"}),e.jsx("span",{className:"capitalize",children:s.replace("_"," ")})]},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Schedule (Optional)"}),e.jsx("input",{type:"datetime-local",value:t.scheduledFor,onChange:s=>i({...t,scheduledFor:s.target.value}),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"})]}),e.jsx("button",{onClick:c,disabled:n,className:"w-full py-3 px-4 bg-purple-600 hover:bg-purple-700 text-white font-medium rounded-lg transition-colors disabled:opacity-50",children:n?"Sending...":"Send Notification"})]})]})},q=()=>{const[t,i]=o.useState([]),[m,l]=o.useState(null);o.useEffect(()=>{n()},[]);const n=async()=>{try{const{data:r}=await u.from("notification_templates").select("*").order("category");i(r||[])}catch(r){console.error("Error fetching templates:",r)}},d=async(r,c)=>{try{await u.from("notification_templates").update({is_active:!c}).eq("id",r),n()}catch(s){console.error("Error toggling template:",s)}};return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Notification Templates"}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700",children:[e.jsx(M,{className:"w-4 h-4"}),"Add Template"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left py-3 px-4",children:"Name"}),e.jsx("th",{className:"text-left py-3 px-4",children:"Category"}),e.jsx("th",{className:"text-left py-3 px-4",children:"Type"}),e.jsx("th",{className:"text-left py-3 px-4",children:"Priority"}),e.jsx("th",{className:"text-left py-3 px-4",children:"Status"}),e.jsx("th",{className:"text-left py-3 px-4",children:"Actions"})]})}),e.jsx("tbody",{children:t.map(r=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:r.name}),e.jsx("p",{className:"text-sm text-gray-600 truncate max-w-xs",children:r.subject||r.body_template})]})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-gray-100",children:r.category})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:"capitalize",children:r.type})}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("span",{className:`px-2 py-1 text-xs rounded-full ${r.priority<=2?"bg-red-100 text-red-700":r.priority===3?"bg-yellow-100 text-yellow-700":"bg-green-100 text-green-700"}`,children:["P",r.priority]})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("button",{onClick:()=>d(r.id,r.is_active),className:`px-3 py-1 text-xs rounded-full ${r.is_active?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"}`,children:r.is_active?"Active":"Inactive"})}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"p-1 hover:bg-gray-100 rounded",children:e.jsx(H,{className:"w-4 h-4 text-gray-600"})}),e.jsx("button",{className:"p-1 hover:bg-gray-100 rounded",children:e.jsx(D,{className:"w-4 h-4 text-red-600"})})]})})]},r.id))})]})})]})},$=()=>{const[t,i]=o.useState([]),[m,l]=o.useState("all"),[n,d]=o.useState(!0);o.useEffect(()=>{r()},[m]);const r=async()=>{d(!0);try{let s=u.from("notifications").select(`
          *,
          users(email, username),
          notification_templates(name, category)
        `).order("created_at",{ascending:!1}).limit(100);m!=="all"&&(s=s.eq("status",m));const{data:x}=await s;i(x||[])}catch(s){console.error("Error fetching notifications:",s)}finally{d(!1)}},c=s=>{switch(s){case"sent":case"delivered":return"text-green-600 bg-green-100";case"pending":case"processing":return"text-yellow-600 bg-yellow-100";case"failed":return"text-red-600 bg-red-100";case"read":return"text-blue-600 bg-blue-100";default:return"text-gray-600 bg-gray-100"}};return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Notification History"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("select",{value:m,onChange:s=>l(s.target.value),className:"px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"sent",children:"Sent"}),e.jsx("option",{value:"delivered",children:"Delivered"}),e.jsx("option",{value:"failed",children:"Failed"}),e.jsx("option",{value:"read",children:"Read"})]}),e.jsx("button",{onClick:r,className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(k,{className:"w-4 h-4"})})]})]}),n?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-purple-600"})}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left py-3 px-4",children:"Recipient"}),e.jsx("th",{className:"text-left py-3 px-4",children:"Notification"}),e.jsx("th",{className:"text-left py-3 px-4",children:"Channel"}),e.jsx("th",{className:"text-left py-3 px-4",children:"Status"}),e.jsx("th",{className:"text-left py-3 px-4",children:"Sent At"})]})}),e.jsx("tbody",{children:t.map(s=>{var x,p,a,h;return e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:(x=s.users)==null?void 0:x.email}),e.jsx("p",{className:"text-sm text-gray-600",children:(p=s.users)==null?void 0:p.username})]})}),e.jsxs("td",{className:"py-3 px-4",children:[e.jsx("p",{className:"text-sm",children:((a=s.notification_templates)==null?void 0:a.name)||"Custom"}),((h=s.notification_templates)==null?void 0:h.category)&&e.jsx("span",{className:"text-xs text-gray-500",children:s.notification_templates.category})]}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:"capitalize",children:s.channel})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${c(s.status)}`,children:s.status})}),e.jsx("td",{className:"py-3 px-4 text-sm text-gray-600",children:s.sent_at?b(new Date(s.sent_at),"MMM d, h:mm a"):b(new Date(s.created_at),"MMM d, h:mm a")})]},s.id)})})]})})]})},L=()=>{const[t,i]=o.useState({byCategory:[],byChannel:[],byHour:[]});o.useEffect(()=>{m()},[]);const m=async()=>{try{const{data:l}=await u.from("notifications").select(`
          *,
          notification_templates(category)
        `).eq("status","sent").gte("created_at",new Date(Date.now()-2592e6).toISOString()),n={},d={},r=Array(24).fill(0);l==null||l.forEach(c=>{var p;const s=((p=c.notification_templates)==null?void 0:p.category)||"custom";n[s]=(n[s]||0)+1,d[c.channel]=(d[c.channel]||0)+1;const x=new Date(c.created_at).getHours();r[x]++}),i({byCategory:Object.entries(n).map(([c,s])=>({name:c,count:s})),byChannel:Object.entries(d).map(([c,s])=>({name:c,count:s})),byHour:r.map((c,s)=>({hour:s,count:c}))})}catch(l){console.error("Error fetching analytics:",l)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Notifications by Category (Last 30 days)"}),e.jsx("div",{className:"space-y-3",children:t.byCategory.map(l=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"w-24 text-sm capitalize",children:l.name}),e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-8 relative",children:e.jsx("div",{className:"absolute left-0 top-0 h-full bg-purple-600 rounded-full flex items-center justify-end px-3",style:{width:`${l.count/Math.max(...t.byCategory.map(n=>n.count))*100}%`},children:e.jsx("span",{className:"text-white text-sm font-medium",children:l.count})})})]},l.name))})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Notifications by Channel"}),e.jsx("div",{className:"grid grid-cols-3 gap-4",children:t.byChannel.map(l=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-purple-600",children:l.count}),e.jsx("div",{className:"text-sm text-gray-600 capitalize",children:l.name.replace("_"," ")})]},l.name))})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Notifications by Hour of Day"}),e.jsx("div",{className:"h-48 flex items-end gap-1",children:t.byHour.map((l,n)=>e.jsxs("div",{className:"flex-1 flex flex-col items-center",children:[e.jsx("div",{className:"w-full bg-purple-600 rounded-t transition-all hover:bg-purple-700",style:{height:`${l.count/Math.max(...t.byHour.map(d=>d.count))*100}%`,minHeight:l.count>0?"4px":"0"}}),n%3===0&&e.jsxs("span",{className:"text-xs text-gray-600 mt-1",children:[n,":00"]})]},n))})]})]})};export{Y as default};
